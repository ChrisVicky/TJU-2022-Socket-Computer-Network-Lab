(window.webpackJsonp=window.webpackJsonp||[]).push([["3c4462be8a3d","6566a5520d19","de20b5688127","55f14c389d78"],{vb115:function(e,t,n){"use strict";n.r(t),n.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return p}),n.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return m}),n.d(t,"addIndexToTableViewMap",function(){return g}),n.d(t,"generateAddTableCs",function(){return y}),n.d(t,"DefaultActions",function(){return d});var r=n("vb273"),a=n.n(r),o=n("vb274"),i=n.n(o),s=n("vb59"),c=n.n(s),B=n("vb114"),v=n("vb375"),D=n("vb191");function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){c()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var p=3,m=[B.FieldType.Text,B.FieldType.Text,B.FieldType.SingleSelect];function g(e){var n=e.viewMap,t=e.views,r={};return t&&t.forEach(function(e,t){r[e]=u({},n[e],{owner:"",index:t})}),u({},e,{viewMap:t?r:n})}function f(r,t){var e=Object.keys(t).filter(function(e){return t[e].type===B.FieldType.Attachment}),n={};if(e.length<=0)return n;var a={};return e.forEach(function(n){Object.keys(r).forEach(function(e){var t=r[e];t[n]&&t[n].value&&(a[n]=a[n]||{},a[n][e]=t[n].value)})}),n[B.ResourceType.Attachments]={data:a},n}function y(e){for(var t=e.tableId,n=e.viewMap,r=e.recordMap,a=e.fieldMap,o=e.memberId,i=e.commentMap,s=void 0===i?{}:i,c=e.resourceMap,l=void 0===c?{}:c,u=e.userMap,d=void 0===u?{}:u,h=e.recordMeta,b=void 0===h?{}:h,f=e.milestoneMap,v=void 0===f?{}:f,p=e.reminderMap,m=void 0===p?{}:p,g=e.renewRecord,y=void 0===g||g,S=e.contentCreation,C=void 0!==S&&S,k=0,T=Object.keys(m);k<T.length;k++){var w=m[T[k]];if(w)for(var E=0,I=Object.keys(w);E<I.length;E++){var O=I[E];w[O]||delete w[O]}}var M={action:B.BaseActionNames.AddTable,type:B.ActionTypes.Base,tableId:t,isRecover:!1,contentCreation:C,renewRecord:y,data:{index:0,name:t,snapshot:{recordMap:r,fieldMap:a,reminderMap:m,viewMap:n,recordMeta:y?{}:b,userMap:d,commentMap:s,resourceMap:l,milestoneMap:v}}};return n&&0!==Object.keys(n).length||B.BitableDep.collectBitableEvent("client_bitable_view_map_state_dev",{table_id:t,stack:(new Error).stack}),{localRev:0,operations:[{actions:[M],command:B.CollaCommands.AddTable,type:B.ActionTypes.Base}],member_id:o,signature:"".concat(o,"-").concat(Object(D.v4)()),type:"USER_CHANGES"}}var d=function(){function o(){a()(this,o)}return i()(o,null,[{key:"addTableUsingTableInstance",value:function(e,t){var n=e.id,r=!0,a=g(e.toJSON()),o=a.viewMap,i=a.recordMap,s=a.recordMeta,c=a.fieldMap,l=a.userMap,u=a.resourceMap,d=a.commentMap,h=a.reminderMap,b=a.milestoneMap,f=y({tableId:n,viewMap:o,recordMap:i,fieldMap:c,userMap:l,memberId:t,contentCreation:r,recordMeta:s,commentMap:d,resourceMap:u,reminderMap:h,milestoneMap:void 0===b?{}:b});return this.stashedActions[n]=f}},{key:"addTableUsingBlockData",value:function(e){var t=e.operations[0].actions[0].tableId;return this.stashedActions[t]=JSON.parse(JSON.stringify(e)),e}},{key:"addTable",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:v.a.Default,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:B.ViewType.Grid,a=3<arguments.length?arguments[3]:void 0,o=Object(B.getNewId)(B.IDPrefix.table,[]);if(r===B.ViewType.Kanban)t=B.TableUtil.createDefaultKanbanByTableId(o,o).toJSON();else if(r===B.ViewType.Gantt)t=B.TableUtil.createDefaultGanttByTableId(o,o,a).toJSON();else if(r===B.ViewType.Gallery)t=B.TableUtil.createDefaultGalleryByTableId(o,o).toJSON();else if(r===B.ViewType.Form)t=B.TableUtil.createDefaultFormByTableId(o,o).toJSON();else{var i=n===v.a.EmbeddedInDoc,s=i?m:B.NEW_VIEW_FIELDS,c=i?p:B.NEW_VIEW_RECORD_COUNT;t=B.TableUtil.createDefaultByTableId(o,o,s,c).toJSON()}var l=g(t),u=l.viewMap,d=l.recordMap,h=l.recordMeta,b=y({tableId:o,viewMap:u,recordMap:d,fieldMap:l.fieldMap,userMap:l.userMap,memberId:e,recordMeta:h});this.stashedActions[o]=b;var f=o+"_"+B.TeaEvent.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;return B.TrackerInstance.start(B.TeaEvent.BlockLoaded,{},{eventKey:f}),f=o+"_"+B.TeaEvent.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken,B.TrackerInstance.start(B.TeaEvent.BlockLoaded,{},{eventKey:f}),b}},{key:"addTableFromSnapshot",value:function(e,t){2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default;var n=Object(B.getNewId)(B.IDPrefix.table,[]),r=t.id?JSON.parse(JSON.stringify(t)):t;r.id=n;var a=r.viewMap,o=r.recordMap,i=r.recordMeta,s=r.fieldMap,c=r.userMap,l=r.resourceMap,u=r.milestoneMap,d=void 0===u?{}:u,h=y({tableId:n,viewMap:a,recordMap:o,fieldMap:s,userMap:c,memberId:e,recordMeta:i,resourceMap:l||f(o,s),milestoneMap:d});this.stashedActions[n]=h;var b=n+"_"+B.TeaEvent.BlockLoaded+"_"+B.BitableBlockLoadedStage.Done;return B.TrackerInstance.start(B.TeaEvent.BlockLoaded,{},{eventKey:b}),b=n+"_"+B.TeaEvent.BlockLoaded+"_"+B.BitableBlockLoadedStage.GetToken,B.TrackerInstance.start(B.TeaEvent.BlockLoaded,{},{eventKey:b}),h}},{key:"addTables",value:function(n,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:v.a.Default,a={},t=e.map(function(e){var t=o.addTableFromSnapshot(n,e,r);return a[e.id]=t.operations[0].actions[0].tableId,t});return o.replaceLinkField(t,a),t}},{key:"replaceLinkField",value:function(e,a){e.forEach(function(e){var t=e.operations[0].actions[0].data.snapshot.fieldMap;for(var n in t){var r=t[n];r.type!==B.FieldType.SingleLink&&r.type!==B.FieldType.DuplexLink||(r.property.tableId=a[r.property.tableId])}})}},{key:"delTable",value:function(e,t){return{operations:{actions:[{action:B.BaseActionNames.DeleteTable,type:B.ActionTypes.Base,tableId:e,data:{index:t}}],command:B.CollaCommands.DeleteTable,type:B.ActionTypes.Base},type:"USER_CHANGES"}}},{key:"clearStashedActions",value:function(){var t=this;Object.keys(this.stashedActions).forEach(function(e){return delete t.stashedActions[e]})}},{key:"jsonToCS",value:function(e){var t=B.Serializer.json.parse(e),n=h(t),r=n.fieldMap,a=n.fieldIds,o=b(t);return{recordMap:o,fieldMap:r,viewMap:S(o,a),userMap:t&&t.userData||{}}}},{key:"csToJSON",value:function(e,t,n,r){if(!e)return null;var a=B.Table.fromJSON(e);if(!a)return null;a.setBase(n);var o=a.getViewById(t);if(!o)return null;var i,s=new B.Range(0,0,o.getAllRecords().length,o.getColumnCount()),c=o.getAllRecords(),l=o.getAllFields();return r&&(i=a.commentMap),o.getStdValueTableFromRange([s],c,l,!1,i)}}]),o}();function h(e){var n={},r=[];return e.header.forEach(function(e,t){0!==t||B.FieldCenter.instance.isSupportPrimary(e.type)||(e.type=B.FieldType.Text,delete e.property),n[e.id]=e,r.push(e.id)}),{fieldMap:n,fieldIds:r}}function b(s){var c={};return s.body.forEach(function(e,o){var i=Object(B.getNewId)(B.IDPrefix.record,[]);c[i]={},s.header.forEach(function(e,t){var n=s.body[o][t];if(n.sourceType!==e.type){var r=[];n.data.forEach(function(e){r.push(e.text)}),r.length&&(n.data=[{type:B.FieldCenter.instance.getStringType(B.FieldType.Text),text:r.join(",")}]),c[i][e.id]={value:n.data}}else{var a=s.bodyCell[o][t];c[i][e.id]=a}})}),c}function S(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],e=Object(B.getNewId)(B.IDPrefix.view,[]),t=B.TableUtil.createDefaultByTableId(e,e,B.NEW_VIEW_FIELDS,B.NEW_VIEW_RECORD_COUNT).toJSON(),a=t.viewMap,o=t.views,i={};return o.forEach(function(e,t){i[e]=u({},a[e],{owner:"",index:t}),i[e].property.fields=r,i[e].property.records=Object.keys(n)}),i}d.stashedActions={}},vb116:function(e,t,n){"use strict";n.r(t);var r=n("vb56"),i=n.n(r),a=n("vb309"),s=n.n(a),o=n("vb64"),u=n.n(o),c=n("vb273"),l=n.n(c),d=n("vb274"),h=n.n(d),b=n("vb147"),f=n("vb114"),v=n("vb53"),p={},m={},g=50,y=8e3,S=2e3,C=8e3;function k(e){return p[e]}function T(e){p[e]=(p[e]||0)+1}function w(e,t){m[e]=t}function E(e){return!!m[e]}function I(e){return Object(f.isUserFieldType)(e)||e===f.FieldType.Text||e===f.FieldType.DateTime}var O="MentionPermissionManager",M="PERMISSION_CHANGE_KEY",B="CHECK_USER_AVATAR_KEY",D=function(){function r(e,t){var n=this;l()(this,r),this.needLoadUserIds=new Set,this.batchFetchUsersArr=[],this.batchFetchOnlyLoadAvatarUsersArr=[],this.isFetchingAvatar=!1,this.batchUpdateFaster=Object(b.a)(function(){n.renderer.updateFaster()},S,{maxWait:C,trailing:!0}),this.batchFetchUsersPemission=function(e){n.needLoadUserIds.add(e),n.fetchUserPermission()},this.fetchUserPermission=Object(b.a)(function(){n.userPermissionManager.addUsers(Array.from(n.needLoadUserIds)),n.needLoadUserIds.clear()},500),this.renderer=e,this.bitableStore=t,this.userPermissionManager=new v.UserPermissionManager({onPermissionChange:function(e){var t=n.renderer.getActiveTable();t&&Object.keys(t.records).forEach(function(e){t.updateRecordVersionMap(e)}),n.batchUpdateFaster(),v.EventEmitter.emit(M,e)},onError:function(e){console.error(e)}})}return h()(r,[{key:"getFieldWhichHasUsers",value:function(e){var t=[];for(var n in e.fields){var r=e.fields[n];I(r.type)&&t.push(r)}return t}},{key:"checkUserToken",value:function(e){return e.type===f.SegmentType.Mention&&e.mentionType===f.MentionType.User&&!Number.isNaN(Number(e.token))}},{key:"initUsers",value:function(){var o=this,i=this.renderer.getActiveTable();if(i){var e=this.getFieldWhichHasUsers(i),s=new Set,r=new Set,c=function(e,t){var n=i.getUserItemById(e);o.bitableStore.addUserWatch(e,i.id,t),(!n||n.avatarUrl&&f.filterUserUrls.some(function(e){return n.avatarUrl.includes(e)}))&&(E(e)||r.add(e))},t=function(a){i.records[a]&&e.forEach(function(n){if(n.type===f.FieldType.Text){var e=i.getCellValue(a,n.id);Array.isArray(e)&&e.forEach(function(e){o.checkUserToken(e)&&(s.add(e.token),c(e.token,n.id))})}else if(n.type===f.FieldType.User){var t=i.getCellValue(a,n.id);t&&Array.isArray(t.users)&&t.users.forEach(function(e){s.add(e.userId),c(e.userId,n.id)})}else if(n.type===f.FieldType.CreatedUser||n.type===f.FieldType.ModifiedUser){n.getUserIds(i,a,n.id).forEach(function(e){s.add(e),c(e,n.id)})}else if(n.type===f.FieldType.DateTime){var r=i.getReminder(a,n.id);r&&r.notifyEntities.users&&r.notifyEntities.users.forEach(function(e){var t=e.userId;s.add(t),c(t,n.id)})}})};for(var n in i.records)t(n);this.fetchUsers(i,Array.from(r)),this.addUsers(Array.from(s))}}},{key:"fetchUsers",value:function(c,e){var l=this,t=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e.length){var a=[],o=function(i){var s=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return l.userPermissionManager.fetchUsers(i).then(function(e){var t=e.payload||{},n=t.entities,a=void 0===n?{}:n,r=t.result_list,o=[];return((void 0===r?[]:r)||[]).forEach(function(e){var t=a[e],n=c.getUserItemById(e),r={userId:e,name:t.cn_name,enName:t.en_name,avatarUrl:t.avatar_url};if(!s&&t.avatar_url)return c.setUserItem(r,!0,s),void l.bitableStore.triggerTableRerenderWhenUserLoad(e);t.avatar_url&&n&&n.avatarUrl!==t.avatar_url&&o.push(e),c.setUserItem(r,!0,s)}),l.addUsers(i),o}).finally(function(){i.forEach(function(e){w(e,!1)})})};e.forEach(function(e){w(e,!0),t?l.batchFetchOnlyLoadAvatarUsersArr.push(e):l.batchFetchUsersArr.push(e)}),Promise.resolve().then(function(){for(;l.batchFetchUsersArr.length;){var e=l.batchFetchUsersArr.splice(0,g);o(e)}}),this.isFetchingAvatar||(this.isFetchingAvatar=!0,setTimeout(u()(i.a.mark(function e(){var t,n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=s()(l.batchFetchOnlyLoadAvatarUsersArr),l.batchFetchOnlyLoadAvatarUsersArr=[],t=[];case 3:if(!a.length){e.next=18;break}return n=a.splice(0,g),e.prev=5,e.next=8,o(n,!0);case 8:(r=e.sent)&&r.length&&t.push.apply(t,s()(r)),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(5),l.isFetchingAvatar=!1,Error(e.t0);case 16:e.next=3;break;case 18:l.isFetchingAvatar=!1,t.forEach(function(e){l.bitableStore.triggerTableRerenderWhenUserLoad(e)});case 20:case"end":return e.stop()}},e,null,[[5,12]])})),y))}}},{key:"addUsers",value:function(e){this.userPermissionManager.addUsers(e),this.bindCellRenderMiddleWare()}},{key:"addUserByAction",value:function(e){var t=this;if(e.action===f.DataActionNames.SetRecord){var n=e.data,r=new Set;for(var a in n){var o=n[a],i=o.type,s=o.value;if(s)if(i===f.FieldType.Text&&Array.isArray(s))s.forEach(function(e){t.checkUserToken(e)&&r.add(e.token)});else if(i===f.FieldType.User&&Array.isArray(s.users))s.users.forEach(function(e){r.add(e.userId)});else if(i===f.FieldType.DateTime){var c=o.reminders&&o.reminders.reminder;c&&c.notifyEntities.users&&c.notifyEntities.users.forEach(function(e){r.add(e.userId)})}}this.userPermissionManager.addUsers(Array.from(r))}}},{key:"setUserItemWithPermission",value:function(e,t,n,r,a){var o=!(5<arguments.length&&void 0!==arguments[5])||arguments[5];e.getUserItemById(t)||(a?e.setUserItem(a):E(t)||k(t)&&!(k(t)<3)||(o&&e.markDirtyForField(n,r),this.fetchUsers(e,[t]),this.addUsers([t]),T(t)));var i=this.userPermissionManager.getPermissionByUser(t);i?e.setUserPermission(t,i):this.batchFetchUsersPemission(t)}},{key:"checkUserPermission",value:function(e,n,r,t,a){var o=this,i=n.fields[r];if(!i)return e;var s=i.type,c=e,l=Object(f.getProxyFieldAndValue)(i,e);return l.proxy&&(i=l.field,c=l.value,s=i.type),s===f.FieldType.Text&&Array.isArray(c)?c.forEach(function(e){var t;e.type===f.SegmentType.Mention&&e.mentionType===f.MentionType.User&&(e.name&&e.en_name&&(t={userId:e.token,name:e.name,enName:e.en_name,avatarUrl:e.link}),o.setUserItemWithPermission(n,e.token,r,a,t))}):Object(f.isUserFieldType)(s)&&c&&Array.isArray(c.users)&&c.users.forEach(function(e){o.setUserItemWithPermission(n,e.userId,r,a)}),e}},{key:"checkUserAvatar",value:function(e,t,n,r,a){var o=this,i=t.fields[n];if(!i)return e;var s=i.type,c=e;if(Object(f.isUserFieldType)(s)&&c&&Array.isArray(c.users)){var l=c.users.map(function(e){return e.userId});l.forEach(function(e){o.bitableStore.addUserWatch(e,t.id,n)});var u=l.filter(function(e){return E(e)||t.checkUserInfo(e)?null:e});if(!u.length)return e;this.fetchUsers(t,u,!0)}return e}},{key:"bindCellRenderMiddleWare",value:function(){var e=this.renderer.activeBitableWidget;e&&(e.middleWare.setMiddleware(O,this.checkUserPermission.bind(this)),e.middleWare.setMiddleware(B,this.checkUserAvatar.bind(this)))}},{key:"reset",value:function(){this.userPermissionManager.destroy();var e=this.renderer.activeBitableWidget;e&&(e.middleWare.removeMiddleware(O),e.middleWare.removeMiddleware(B))}},{key:"addPermissionChangeListener",value:function(e){v.EventEmitter.on(M,e)}},{key:"removePermissionChangeListener",value:function(e){v.EventEmitter.off(M,e)}}]),r}(),x=function(){function e(){l()(this,e),this.userValidMap={}}return h()(e,[{key:"setUserItemValid",value:function(e){this.userValidMap[e]={isValid:!0}}},{key:"checkUserInfo",value:function(e){var t=!1;return e&&this.userValidMap[e]&&(t=this.userValidMap[e].isValid),t}},{key:"init",value:function(){this.userValidMap={}}}]),e}(),P=n("vb310"),R=n("vb362");function _(e){Object(v.injectBitableDep)(e),f.BitableGlobalConfig.setGlobalConfig({UserManagerHelper:{MentionPermissionManager:D,UserValidationManager:new x},config:{cardSyncMode:f.CardSyncMode.RealTime},collectBitableEvent:P.b,GzipWorker:new R.a})}n.d(t,"default",function(){return _})},vb1203:function(e,n,t){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}n.__esModule=!0,r(t("vb1204"))},vb1204:function(e,t,n){"use strict";t.__esModule=!0;var o=n("vb109"),i=n("vb453"),s=n("vb1205"),c=n("vb763");function r(t,e){var n=void 0;var r=o.default({context:t,sagaMonitor:n,onError:e}),a=i.getRefCountedManager(s.getSagaManager(r),c.sagaEquals);return{middleware:[r],onModuleManagerCreated:function(e){t&&(t.moduleManager=e)},onModuleAdded:function(e){e.sagas&&a.add(e.sagas)},onModuleRemoved:function(e){e.sagas&&a.remove(e.sagas)},dispose:function(){a.dispose()}}}t.getSagaExtension=r},vb1205:function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r};t.__esModule=!0;var a=n("vb763"),o=n("vb453");function i(t){var n=o.getMap(a.sagaEquals);return{getItems:function(){return r(n.keys)},add:function(e){e&&e.forEach(function(e){e&&!n.get(e)&&n.add(e,s(t,e))})},remove:function(e){e&&e.forEach(function(e){n.get(e)&&n.remove(e).cancel()})},dispose:function(){n.keys.forEach(function(e){return n.get(e).cancel()})}}}function s(e,t){if("function"==typeof t){var n=t;return e.run(n)}var r=t.saga,a=t.argument;return e.run(r,a)}t.getSagaManager=i},vb1206:function(e,t,n){"use strict";t.__esModule=!0;var r=n("vb206");function a(){return{middleware:[r.default]}}t.getThunkExtension=a},vb1207:function(e,h,b){"use strict";(function(s){b.d(h,"a",function(){return u});var e=b("vb309"),d=b.n(e),t=b("vb56"),c=b.n(t),n=b("vb64"),a=b.n(n),r=b("vb273"),o=b.n(r),i=b("vb274"),l=b.n(i),u=function(){function r(e,t,n){var i=this;o()(this,r),this.components=e,this.contentManager=t,this.displayMultiple=n,this.notifyCommentLoadedMap=new Map,this.notifyCommentBatchUpdateMap=new Map,this.comments=null,this.getComments=function(e){var t=i.getComponents(e);return t?t.getComments(e):i.getDefaultComments(e)},this.setOnCommentBatchUpdate=function(e,t,n){var r=i.getComponents(e);r?r.setCommentBatchUpdate(e,t,n):i.setNotifyCommentBatchUpdateFn(e,t)},this.setCommentData=function(e,t){i.comments=t.comments;var n=i.getComponents(e);if(!n){var r=i.getDefaultComments(e),a=i.getNotifyCommentBatchUpdateFn(e);return a&&a(r),Promise.resolve()}return n.setCommentData(e,t)},this.startNewComment=function(e,t,n){var r=i.getComponents(e);if(r)return r.startNewComment(e,t,n)},this.getResolvedComments=function(e){var t=i.getComponents(e);return t?t.getResolvedComments(e):[]},this.setResolvedCommentIds=function(e,t){var n=i.getComponents(e);if(n)return n.setResolvedCommentIds(e,t)},this.addHoverHighlight=function(e,t){var n=i.getComponents(e);if(n)return n.addHoverHighlight(e,t)},this.removeHoverHighlight=function(e,t){var n=i.getComponents(e);if(n)return n.removeHoverHighlight(e,t)},this.resolveComment=function(){var n=a()(c.a.mark(function e(t,n){var r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.resolveComment(t,n));case 4:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.activateComment=function(e,t){var n=i.getComponents(e);if(n)return n.activateComment(e,t)},this.deactivateComment=function(e,t){var n=i.getComponents(e);if(n)return n.deactivateComment(e,t)},this.reopenComment=function(){var n=a()(c.a.mark(function e(t,n){var r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.reopenComment(t,n));case 4:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.findComment=function(){var n=a()(c.a.mark(function e(t,n){var r,a,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.getComponents(t)){e.next=5;break}return a=i.getDefaultComments(t),o=a.find(function(e){return e.commentId===n}),e.abrupt("return",o);case 5:return e.abrupt("return",r.findComment(t,n));case 7:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.getTeaParams=function(e,t){var n=i.getComponents(e);if(n)return n.getTeaParams(e,t)},this.getSmartableCommentManager=function(e){var t=i.getComponents(e);if(t)return t.getSmartableCommentManager(e)},this.getCommentPositions=function(e){var t=i.getComponents(e);if(t)return t.getCommentPositions(e)}}return l()(r,[{key:"setNotifyCommentLoadedFn",value:function(e,t){this.notifyCommentLoadedMap.set(e,t)}},{key:"getNotifyCommentLoadedFn",value:function(e){return this.notifyCommentLoadedMap.get(e)}},{key:"setNotifyCommentBatchUpdateFn",value:function(e,t){this.notifyCommentBatchUpdateMap.set(e,t)}},{key:"getNotifyCommentBatchUpdateFn",value:function(e){return this.notifyCommentBatchUpdateMap.get(e)}},{key:"getDefaultComments",value:function(e){var t=[],n=this.contentManager.dataSource.getSource().base.getTableById(e);if(!n)return t;var r=this.contentManager.dataSource.getShowingViewId(n.id),a=r?n.getViewById(r):n.views[0];if(!a)return t;var o=a.getVisibleRecords(),i=this.generateTableCommentMap(n),s=Object.keys(i);if(o)for(var c=0;c<s.length;c++){var l=s[c];if(o.includes(l)){var u=(i[l]||[]).filter(function(e){return!e.isResolved});t.push.apply(t,d()(u))}}return t}},{key:"generateTableCommentMap",value:function(e){var t=this.comments,i={};if(t&&e&&0<t.length)for(var n=e.commentMap||{},r=Object.keys(n),a=function(e){var a=r[e],o=n[a];if(o&&o.length<0)return"continue";t.forEach(function(e){var t=e.commentId,n=e.finish;if(o&&o.includes(t)){var r={recordId:a,commentId:t,quote:s("bitable.comment_title",""),isResolved:!!n,offsetTop:0,offsetHeight:0};i[a]?i[a]=i[a].concat(r):i[a]=[r]}})},o=0;o<r.length;o++)a(o);return i}},{key:"getComponents",value:function(e){var t=this.components.get(e);return this.displayMultiple||(t=this.components.values().next().value),t}},{key:"getActiveComments",value:function(e){var t=this.getComponents(e);return t?t.getActiveComments(e):[]}},{key:"saveComment",value:function(){var r=a()(c.a.mark(function e(t,n,r){var a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",a.saveComment(t,n,r));case 4:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"removeComment",value:function(){var n=a()(c.a.mark(function e(t,n){var r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.removeComment(t,n));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"removeTempComment",value:function(){var n=a()(c.a.mark(function e(t,n){var r;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getComponents(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.removeTempComment(t,n));case 4:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()}]),r}()}).call(this,b("vb152"))},vb1208:function(e,b,f){"use strict";(function(n){f.d(b,"a",function(){return h});var e=f("vb56"),s=f.n(e),t=f("vb273"),r=f.n(t),a=f("vb274"),o=f.n(a),i=f("vb64"),c=f.n(i),l=f("vb53");function u(e,t,n,r){return d.apply(this,arguments)}function d(){return(d=c()(s.a.mark(function e(t,n,r,a){var o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new FormData).set("token",r),o.set("tableId",a),o.set("srcToken",t),o.set("srcTableId",n),o.set("rev","0"),e.abrupt("return",l.request.post(Object(l.prependAPI)("/api/bitable/applytemplate/"),o,{headers:{"Content-Type":"multipart/form-data"}}));case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var h=function(){function t(e){var i=this;r()(this,t),this.useTemplate=function(){var t=c()(s.a.mark(function e(t){var n,r,a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.templateToken,r=t.tableId,e.prev=1,a=i.dataSource.getToken(),e.next=5,u(n,"",a,r);case 5:return o=e.sent,i.dataSource.fetchTableToMaxVersion(r,1),e.abrupt("return",o);case 10:return e.prev=10,e.t0=e.catch(1),i.showError(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=e}return o()(t,[{key:"showError",value:function(e){console.error(e),l.Toast.show({type:"error",closable:!0,content:n("common.apply_template_fail")})}}]),t}()}).call(this,f("vb152"))},vb1209:function(e,x,P){"use strict";(function(a){P.d(x,"a",function(){return D});var e=P("vb56"),o=P.n(e),t=P("vb64"),n=P.n(t),r=P("vb59"),i=P.n(r),s=P("vb273"),c=P.n(s),l=P("vb274"),u=P.n(l),d=P("vb415"),h=P.n(d),b=P("vb394"),f=P.n(b),v=P("vb284"),p=P.n(v),m=P("vb58"),g=P.n(m),y=P("vb594"),S=P("vb114"),C=P("vb90"),k=P("vb53"),T=(P("vb765"),P("vb479")),w=P("vb480"),E=P("vb766");function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach(function(e){i()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var M=!0,B=function(t){function i(e){var n;return c()(this,i),(n=t.call(this,O({},e,{isVCEnable:M}))||this).getCommentPositions=function(e){return n.smartableCommentManager.getCommentPositions(e)},n.setHistory=function(){n.renderer.storageManager.setHistory(n.props.history)},n.loadedTable=function(e){n.renderer.loadedTable(e)},n.switchTable=function(e){n.renderer.switchTable(n.bitableStore.base,e)},n.addNewTable=function(e){var t=n.bitableStore.base;k.store.dispatch(Object(S.updateTables)(t)),n.renderer.addNewTable(t,e),n.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return n.state.delayLoading&&n.setState({delayLoading:!1})})})},n.handleUploadError=function(e){var t=e&&e.errorType;if(k.BearWebHelper&&!k.BearWebHelper.isLark()&&k.Constant&&t===k.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)k.BearWebHelper.triggerStoragePicLimitDialog();else{if(k.BearWebHelper&&k.Constant&&t===k.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var n={mountPoint:e.mountPoint,mountNodeToken:e.parentToken},r={meta:{}};return e.file.data.viewType===S.ViewType.Form&&(r.meta.reason="bitable_form_upload_file"),void k.BearWebHelper.triggerUserPicLimitDialog(n,r)}k.Toast.show({type:"error",content:a("common.server_busy")})}},n}return p()(i,t),u()(i,[{key:"componentDidMount",value:function(){var e=n()(o.a.mark(function e(){var t,n,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h()(f()(i.prototype),"componentDidMount",this).call(this),t=this.props,n=t.tableId,r=t.mountOption,!(a=r.operator)){e.next=7;break}return e.next=6,this.bitableStore.waitTableClientVarLoaded(n);case 6:a.onTableLoaded&&a.onTableLoaded();case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentDidUpdate",value:function(e){h()(f()(i.prototype),"componentDidUpdate",this).call(this,e);var t=this._token;if(e.token===t){if(!Object(S.isShortCut)())return;var n=this.props.query,r=e.query,a=n.get(S.QUERY_TABLE_KEY)||null,o=n.get(S.QUERY_VIEW_KEY)||null;(a!==r.get(S.QUERY_TABLE_KEY)||o!==r.get(S.QUERY_VIEW_KEY))&&a&&o&&this.renderer&&this.renderer.switchView(this.bitableStore.base,a,o)}this.props.onLoaded&&!this._onMountFired&&(this._onMountFired=!0,this.props.onLoaded()),this.props.onRecover&&this.addRecoverCallback(this.props.onRecover)}},{key:"componentWillReceiveProps",value:function(e){e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze())}},{key:"initCommentManager",value:function(){var e=this.bitableStore,t=this.renderer,n=this.props,r=n.mountOption,a=n.suiteToken,o=n.suiteType,i=r.operator,s={onTableLoaded:i.onTableLoaded,onBatchUpdateBlockComment:i.onBatchUpdateBlockComment,onStartNewComment:i.onStartNewComment};this.commonInit=new E.a({suiteToken:a,suiteType:o});var c=k.CommentHelper&&k.CommentHelper.sheetNewCommentEnable;this.smartableCommentManager=new S.AloneSmartableCommentManager({renderer:t,bitableStore:e,comment:s,customCommentCard:c?w.b:void 0,customCommentBar:c?w.a:void 0})}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.tableId,a=e.viewId,o=e.onTableChangedInUndo,i=e.mountOption,s=this.state,c=s.suspend,l=s.height,u=s.delayLoading,d=i.hideComment,h=i.isTemplateMode,b=!(k.browser.isFeed||d);return c?null:g.a.createElement(S.SheetBitable,{token:n,bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,onTableChangedInUndo:o,mountOption:i,ready:!0,isTemplateMode:h,height:l,delayLoading:u,IOConfig:{IO:k.IO.getInstance()},bitableConfig:{attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:k.SOURCE_ENUM.SHEET},ui:{showComment:b}},isVCEnable:M})}}]),i}(y.a),D=Object(C.connect)(function(e,t){var n=!k.SuiteReduxSelector||!k.SuiteReduxSelector.selectIsInEditMode||k.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:Object(S.activeTableIdSelector)(e)||t.tableId,viewId:Object(S.activeViewIdSelector)(e),query:Object(k.selectQuery)(e),isEditMode:n,editable:Object(T.a)(e),suiteType:k.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:k.SuiteReduxSelector.selectCurrentSuiteToken(e)}})(B)}).call(this,P("vb152"))},vb121:function(e,t,n){"use strict";n.r(t);var r,a,s,o,i=n("vb273"),u=n.n(i),c=n("vb274"),d=n.n(c),l=n("vb393"),h=n.n(l),b=n("vb415"),y=n.n(b),f=n("vb394"),S=n.n(f),v=n("vb284"),p=n.n(v),m=n("vb331"),g=n.n(m),C=n("vb131"),k=n("vb56"),T=n.n(k),w=n("vb64"),E=n.n(w),I=n("vb59"),O=n.n(I),M=n("vb87"),B=n.n(M),D=n("vb936");(a=r||(r={})).INSIDE_PAGE="insidePage",a.PASTE="paste",a.USER_INSERT="userInsert",(o=s||(s={}))[o.Add=0]="Add",o[o.Paste=1]="Paste",o[o.Del=2]="Del";var x=n("vb114"),P=n("vb1207");function R(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?R(Object(n),!0).forEach(function(e){O()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var L,j,F=!0,U=function(){function i(e,t,n,r,a,o){var c=this;u()(this,i),this.token=e,this.displayMultiple=t,this.getOrders=n,this.hostType=r,this.blockExtraFunctions=a,this.reduxStore=o,this.mountQueue=[],this.mountEventQueue=new Map,this.hosts={},this.containers={},this.isRender=!1,this.mountOptions={},this.mountingInfo=null,this.autoSwitchActiveId=!1,this.selectionState=[],this.updateSelectionStateCoreTimer=0,this.previewHistoryOptions={isHighlight:!1,users:{}},this.blockMountResolver=new Map,this.isBlockMount=new Map,this.mountNext=function(){var e=c.mountQueue.shift();if(c.mountingInfo=null,e){var t=e.id,n=e.option;if(t){var r=n.createdSource===x.BitableDep.ExternalConst.CreatedSource.USER_INSERT,a=n.createdSource===x.BitableDep.ExternalConst.CreatedSource.PASTE;if(!r&&!a){var o=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done;x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:o})}var i=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.InitSmartable;if(x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:i}),c.mountOptions[t]=n,c.mountingInfo=e,!c.displayMultiple&&c.isRender)return c.mountingInfo.resolve(),c.mountingInfo=null,c.active(t),void(0<c.mountQueue.length&&setTimeout(function(){c.mountingInfo=null,c.mountNext()}));if(c.contentManager){var s=c.hosts[t];s?(x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_next",table_id:t}),c.isRender=!0,B.a.render(c.getEmbeddedComponent(t),s),setTimeout(function(){c.mountingInfo=null,c.mountNext()},200)):c.collectMountError("contentManager host undefined",t)}else c.collectMountError("contentManager undefined",t)}}},this.updateBlockMountStatus=function(e){var t=c.blockMountResolver.get(e);t&&t.forEach(function(e){e&&e()})},this.onComponentContentLoaded=function(e,t){e&&e.resolve();var n=t.base.getTableById(e.id),r={};n&&(r={fields_num:Object.keys(n.fields).length,records_num:Object.keys(n.records).length}),r.createdSource=e.option.createdSource,x.BitableDep.injectBitableDepAsync&&x.BitableDep.injectBitableDepAsync();var a=e.id+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.DomRender;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,_({stage:x.BitableBlockLoadedStage.DomRender},r),{eventKey:a}),a=e.id+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done,x.TrackerInstance.send(x.TeaEvent.BlockLoaded,_({stage:x.BitableBlockLoadedStage.Done},r),{eventKey:a}),x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_render_done",table_id:e.id})},this.onClientVarLoaded=function(){var t=E()(T.a.mark(function e(t){var n,r,a,o;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.contentManager.getTableById(t)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.waitTableLoaded();case 5:if(!(r=c.contentPersenters.get(t))){e.next=9;break}return e.next=9,r.handleBitableIfPaste();case 9:a=c.commentManager.getNotifyCommentLoadedFn(t),o=c.commentManager.getComments(t),a&&a(o),c.uiManager.updateErrorCodeType(t);case 13:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.onClientVarError=function(e,t){var n=c.mountEventQueue.get(e);n&&n(),c.mountOptions[e]&&(c.mountOptions[e].errorCodeType=Object(x.getErrorCodeType)(t)),c.uiManager.updateErrorCodeType(e,Object(x.getErrorCodeType)(t))},this.onTableChangedInUndo=function(e){if(c.mountOptions[e]){var t=c.mountOptions[e].operator.activeTab;t&&t(e)}},this.onDataChanged=function(e){if(c.mountOptions[e]){var t=c.mountOptions[e].operator.onChanged;t&&t(e)}},this.internalSizeChanged=function(e,t,n,r,a,o){if(c.mountOptions[e]){var i=c.mountOptions[e].operator.internalSizeChange;i&&i(n,t,r,a,o)}},this.editbarPinChanged=function(e,t){if(c.mountOptions[e]){var n=c.mountOptions[e].operator.editbarPinChange;n&&n(t)}},this.updateSelectionState=function(n,e,r){var t=function(){1===c.selectionState.length?c.selectionState.forEach(function(e){var t=c.contentPersenters.get(n);t&&(t.getSelection()?c.uiManager.updateSelectionState(e,!1,r):c.uiManager.updateSelectionState(e,!0,r))}):c.selectionState.forEach(function(e){c.uiManager.updateSelectionState(e,!0,r)})};window.clearTimeout(c.updateSelectionStateCoreTimer),e?(c.selectionState.push(n),c.updateSelectionStateCoreTimer=window.setTimeout(t,10)):(c.selectionState=c.selectionState.filter(function(e){return e!==n}),c.uiManager.updateSelectionState(n,!1))},this.findNextActiveId=function(t){if(!c.contentManager)return"";var e=c.contentManager.dataSource.getActivedId();if(e!==t)return e;var n=c.mountedIds.findIndex(function(e){return e===t}),r=0<n?n-1:1;return c.mountedIds[r]},this.activeNext=function(e){if(c.contentManager&&c.contentManager.dataSource&&0<c.mountedIds.length){var t=c.contentManager.dataSource;(t.getIndexFromId(e)||0)!==t.getIndexFromId(t.getActivedId())&&t.active(t.getIndexFromId(e)||0)}},this.addContentPresenter=function(){var e=c.getAction(s.Add,null);c.contentManager&&c.contentManager.executeLocalActions(e)},this.pasteContentPresenter=function(e){var t=c.getAction(s.Paste,e);c.contentManager&&c.contentManager.executeLocalActions(t)},this.delContentPresenter=function(e){var t=c.getAction(s.Paste,e);c.contentManager&&c.contentManager.executeLocalActions(t)},this.contentPersenters=new Map,this.contentManager=this.createContentManager(),this.uiManager=new D.b(this.contentPersenters),this.commentManager=new P.a(this.contentPersenters,this.contentManager,t),this.mountedIds=[],n&&n().forEach(function(e){c.mountedIds.push("object"===g()(e)?e.tableId:e)})}return d()(i,[{key:"mountContentPresenter",value:function(e){var t=e.id,n=e.host;try{if(F){var r=window.scmbitable.tracker;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.CommonjsLoad,cost_time:r.common_cost_time},{eventKey:x.BitableBlockLoadedStage.CommonjsLoad}),x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.SmartablejsLoad,cost_time:r.initBitable_const_time},{eventKey:x.BitableBlockLoadedStage.SmartablejsLoad}),x.BitableDep.collectBitableEvent("bitable_scm",{bitableVersion:window.scmbitable.scmInfo.version,bitableSdkVersion:window.scmbitable.pkgInfo.sdk_version,bearwebVersion:window.scm.version,masterVersion:window.scmbitable.tracker.masterVersion.garrMaster,stage:window.scmbitable.stage})}F=!1}catch(e){console.log(e)}var a=e.createdSource===x.BitableDep.ExternalConst.CreatedSource.USER_INSERT,o=e.createdSource===x.BitableDep.ExternalConst.CreatedSource.PASTE;if(a||o){var i=t+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.GetToken;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.GetToken},{eventKey:i})}if(!n){var s="Container Cannot Be Null";throw this.collectMountError(s,t),new Error(s)}if(0<this.mountQueue.filter(function(e){return e.id===t}).length){var c="MountQueue Repeat";throw this.collectMountError(c,t),new Error(c)}return this.contentManager.initUndoManager(e.undoDispatcher),this.currentActiveId=e.id,this.mountOptions[t]=e,this.addHost(t,n),x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_queue_add",table_id:t}),this.mountPromise(t,e)}},{key:"addHost",value:function(e,t){if(this.containers[e]=this.containers[e]||t,this.displayMultiple||!(0<Object.keys(this.hosts).length)){var n=this.hosts[e]||document.createElement("div");this.displayMultiple||(n.className="bitable-in-sheet__component-wrapper"),t.innerHTML="",t.appendChild(n),this.hosts[e]=n}}},{key:"mountPromise",value:function(n,r){var a=this;return new Promise(function(e,t){a.mountQueue.push({id:n,option:r,resolve:e,reject:t}),a.mountEventQueue.set(n,e),a.mountingInfo||a.mountNext()})}},{key:"getEmbeddedComponent",value:function(t){var n=this;return this.createEmbeddedComponent(t,function(e){return n.onComponentDidMount(t,e,n.mountingInfo)},this.onComponentContentLoaded,this.mountingInfo)}},{key:"notify",value:function(n,r){var a=r.targetIds;this.contentPersenters.forEach(function(e,t){t!==n&&(!a||-1<a.indexOf(t))&&e.receive(r.name)})}},{key:"getIsBlockMount",value:function(e){return!!this.isBlockMount.get(e)}},{key:"waitBlockMount",value:function(n){var r=this;return new Promise(function(e){if(r.getIsBlockMount(n))e();else{var t=r.blockMountResolver.get(n)||[];t.push(e),r.blockMountResolver.set(n,t)}})}},{key:"onComponentDidMount",value:function(t,n,e){var r=this;if(!this.isDestroyed){n.setNotifier(function(e){return r.notify(t,e)}),this.contentPersenters.set(t,n);var a={onClientVarLoaded:function(){var e=E()(T.a.mark(function e(){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.handleBitableIfPaste();case 2:n.onLoadedTable();case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),addNewTable:function(){},switchTable:function(){},onClientVarError:this.onClientVarError};if(e&&e.option&&e.option.historyInfo){var o=e.option.historyInfo;n.previewHistory(o,_({activeTableId:t},this.previewHistoryOptions))}else{var i=this.mountOptions[t],s=i.isHistoryMode,c=i.isTranslateMode;this.contentManager.initContents([t],t,a,s||c,2),this.contentManager.translateMode&&this.contentManager.dataSource.freeze()}this.updateBlockMountStatus(t),this.isBlockMount.set(t,!0)}}},{key:"activeBitable",value:function(e){this.setActiveBitableId(e),this.active(e)}},{key:"setActiveBitableId",value:function(e){this.currentActiveId=e}},{key:"enterHistoryMode",value:function(e,t,n){}},{key:"active",value:function(e){if(this.currentActiveId===e){var t=this.contentPersenters.values().next().value;if(!this.displayMultiple&&t){var n=Object.values(this.hosts)[0],r={switchTable:function(){t.switchTable(e)},onClientVarLoaded:function(){t.loadedTable(e)},addNewTable:function(){t.addNewTable(e)},onClientVarError:this.onClientVarError};n.parentElement&&n.parentElement.removeChild(n),this.containers[e].appendChild(n);var a=this.mountOptions[e],o=a.isHistoryMode,i=a.isTranslateMode;this.contentManager.initContents([e],e,r,o||i)}}}},{key:"unmountContentPresenter",value:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=this.hosts[t];if(this.contentManager&&(r||!this.displayMultiple)){var a=this.contentPersenters.get(t);if(delete this.uiManager.getContainerSize()[t],a&&(a.cancelPaste(),a.destroy()),delete this.containers[t],this.selectionState=this.selectionState.filter(function(e){return e!==t}),e){var o=this.commentManager.getSmartableCommentManager(t);o&&o.showNewCommentFailTip(t)}if(this.displayMultiple){this.contentPersenters.delete(t),delete this.hosts[t],delete this.mountOptions[t];var i=this.autoSwitchActiveId?this.findNextActiveId(t):null;this.mountQueue=this.mountQueue.filter(function(e){return e.id!==t});try{B.a.unmountComponentAtNode(r),this.autoSwitchActiveId&&(i&&0<i.length&&this.activeNext(i),this.mountedIds=[],this.getOrders&&this.getOrders().forEach(function(e){n.mountedIds.push("object"===g()(e)?e.tableId:e)}),this.contentManager&&this.contentManager.reorder())}catch(e){}}else if(0===Object.keys(this.containers).length){var s=Object.values(this.hosts)[0];s&&B.a.unmountComponentAtNode(s),this.contentPersenters.clear(),this.hosts={},this.mountOptions={},this.isRender=!1}}}},{key:"fetchClientVars",value:function(e,t){this.contentManager.initContents(e,t,{onClientVarLoaded:this.onClientVarLoaded,onClientVarError:this.onClientVarError})}},{key:"freeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.freeze()}},{key:"unfreeze",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.unfreeze()}},{key:"suspend",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.suspend(e)}},{key:"resume",value:function(e){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.resume(e)}},{key:"enableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.enableEdit()}},{key:"disableEdit",value:function(){this.contentManager&&this.contentManager.dataSource&&this.contentManager.dataSource.disableEdit()}},{key:"previewHistory",value:function(t,e){var n=this;e&&e.users&&(this.previewHistoryOptions.isHighlight=Boolean(e.isHighlight),Object.assign(this.previewHistoryOptions.users,e.users)),this.contentPersenters.forEach(function(e){e.previewHistory(t,n.previewHistoryOptions)});var r=t.revInfo,a=[];for(var o in r){var i=r[o];i.firstRev!==i.lastRev&&a.push(o)}return a}},{key:"locateHistory",value:function(e,t){var n=this.contentPersenters.get(e);n&&"locate"in n&&n.locate(t)}},{key:"highlightHistory",value:function(t){this.contentPersenters.forEach(function(e){e.highlightHistory(t)})}},{key:"showAllHistoryLabels",value:function(e){var t=this.contentPersenters.get(e);t&&t.showAllHistoryLabels()}},{key:"clearHistoryLabel",value:function(e){var t=this.contentPersenters.get(e);t&&t.clearHistoryLabel()}},{key:"setRecoverTransactionId",value:function(t){this.contentPersenters.forEach(function(e){e.setRecoverTransactionId(t)})}},{key:"exitHistoryMode",value:function(){this.contentPersenters.forEach(function(e){e.exitHistory()})}},{key:"collectMountError",value:function(e,t){x.BitableDep.collectBitableEvent("client_bitable_block_mount",{stage:"mount_failed",table_id:t,errorMessage:e})}},{key:"destroy",value:function(){var n=this;try{this.isDestroyed=!0,this.mountQueue=[],this.mountingInfo=null,this.contentPersenters.forEach(function(e,t){return n.unmountContentPresenter(t)}),this.contentPersenters.clear(),this.contentManager&&this.contentManager.destroy(),this.hosts={},this.mountOptions={}}catch(e){throw e}}}]),i}(),V=n("vb66"),H=n.n(V),N=n("vb52"),W=n("vb148"),z=n("vb430"),K=n("vb115"),X=n("vb1208"),J=n("vb133"),Q=n.n(J),q=function(){function s(e,t,n,r,a,o){var i=this;u()(this,s),this.undoManager=t,this.getOrders=r,this.isCreateAction=a,this.displayMultiple=o,this.actionAfterLoaded=[],this.loaded=!1,this.clientVarsReady=!1,this.translateMode=!1,this._updateTime=0,this.initContents=function(e,t,n,r,a){var o=i.displayMultiple?e:[t];i.dataSource.prefetchClientVars(o,t,n,r,a),i.dataSource.setUndoManger(i.undoManager),i.bindEvents()},this.getAllMention=function(){return i.dataSource.getAllMention()},this.getTableDataForServerCopy=function(e){return i.dataSource.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(e){return i.dataSource.removeLocalConflictRecord(e)},this.isLoaded=function(){return i.loaded||(i.loaded=i.dataSource.isAllLoaded()),i.loaded},this.isClientVarsReady=function(){return i.clientVarsReady},this.bindEvents=function(){},this.unbindEvents=function(){},this.applyBitableTemplate=function(){var t=E()(T.a.mark(function e(t){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.templateManager.useTemplate(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.dataSource=n(e),this.templateManager=new X.a(this.dataSource)}return d()(s,[{key:"initUndoManager",value:function(e){this.undoManager.register(e)}},{key:"getUpdatedTime",value:function(){return this._updateTime}},{key:"updateTime",value:function(){this._updateTime=Date.now()}},{key:"getTranslateManager",value:function(){}},{key:"enterTranslateMode",value:function(){x.RendererManager.enterSandbox(),this.translateMode=!0}},{key:"exitTranslateMode",value:function(){x.RendererManager.quitSandboxNextTick(),this.translateMode=!1,this.dataSource.unfreeze()}},{key:"reorder",value:function(){var a=this;this.getOrders().filter(function(e){return"object"===g()(e)?a.dataSource.exists(e.tableId):a.dataSource.exists(e)}).forEach(function(e,t){var n="object"===g()(e)?e.tableId:e,r=a.dataSource.getIndexFromId(n);null!==r&&-1!==r&&-1!==t&&r!==t&&t<a.dataSource.getLength()&&a.dataSource.move(r,t)})}},{key:"onLoaded",value:function(e){this.dataSource.isAllLoaded()&&(this.reorder(),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!1),this.actionAfterLoaded=[]),this.actionAfterLoaded.length&&(this.applyActions(this.actionAfterLoaded,!0),this.actionAfterLoaded=[]),this.dataSource.unfreeze())}},{key:"handleCSV",value:function(e){return this.dataSource.handleCSV(e)}},{key:"handleCopy",value:function(e){return this.dataSource.copy(e)||""}},{key:"handlePaste",value:function(e,t,n,r,a){return be.paste(e,t,this.displayMultiple,n,r,a)}},{key:"handlePasteBlock",value:function(){var a=E()(T.a.mark(function e(t,n,r,a){var o,i,s,c,l,u,d,h,b,f,v,p,m,g,y,S,C,k;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=Object(x.getNewId)(x.IDPrefix.table,[]),e.prev=1,i=JSON.parse(t),e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(1),console.error(e.t0),e.abrupt("return",null);case 9:if(s=be.genPasteBitaleSnapshot(t,i,o)){e.next=12;break}return e.abrupt("return",null);case 12:if(c=s.snapshot,l=s.contentCreation,u=this.dataSource.getSource(),d=u.base.token,h=i.baseId,Q()(d)===h){e.next=24;break}return e.prev=17,e.next=20,Object(x.deepCopyBitableDriveTokenFromSnapshot)(c,d);case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(17);case 24:return b=c.recordMeta||{},f=r?c.commentMap:{},v=c.viewMap,p=c.recordMap,m=c.fieldMap,g=c.userMap,y=c.resourceMap,S=c.reminderMap,C=c.milestoneMap,k={tableId:o,viewMap:v,recordMap:p,fieldMap:m,userMap:g,reminderMap:S,resourceMap:y,memberId:n,contentCreation:l,recordMeta:b,resetRecordMeta:a,commentMap:f,milestoneMap:void 0===C?{}:C},e.abrupt("return",Object(K.generateAddTableCs)(k));case 29:case"end":return e.stop()}},e,this,[[1,5],[17,22]])}));function e(e,t,n,r){return a.apply(this,arguments)}return e}()},{key:"getInitBitableCs",value:function(e,t,n){return K.DefaultActions.addTable(e,t,n)}},{key:"getActiveViewIdMap",value:function(){return be.getActiveViewIdMap()}},{key:"getDeleteConfirmModal",value:function(e,t){}},{key:"checkUIIfChanged",value:function(e,t){}},{key:"executeLocalActions",value:function(e){this.isLoaded()?this.applyActions([e],!0):this.actionAfterLoaded.push(e)}},{key:"applyActions",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e=e.filter(function(e){return!t.isCreateAction(e)||!t.dataSource.exists(e.id)}),this.dataSource.applyActions(e,n)}},{key:"destroy",value:function(){try{this.unbindEvents(),this.dataSource.destroy(),this.loaded=!1}catch(e){throw e}}},{key:"recoverTableHistory",value:function(e){}},{key:"getTableRevision",value:function(){var t=E()(T.a.mark(function e(t){var n,r;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.dataSource.getSource(),r=n.base.getTableById(t),e.abrupt("return",r?r.rev:n.remoteDataProvider.fetchRemoteVersion(!1,t));case 3:case"end":return e.stop()}},e,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"getTableById",value:function(e){return this.dataSource.getSource().base.getTableById(e)}}]),s}(),Y=n("vb117");(j=L||(L={}))[j.execute=0]="execute",j[j.undo=1]="undo",j[j.redo=2]="redo";var Z=65535,$="BITABLE",ee=function(e){function t(){var r;return u()(this,t),(r=e.call(this,$)||this).execCmd=function(e,t){var n=h()(r).commandManager;return e&&n&&n.hasCommand(e.cmd)?n._executeActions(e.cmd,{result:x.ExecuteResult.Success,data:{},actions:e.actions},t):null},r}return p()(t,e),d()(t,[{key:"setCommandManager",value:function(e){this.commandManager=e}}]),t}(function(){function t(e){u()(this,t),this.blockId=e,this.undoStack=[],this.redoStack=[]}return d()(t,[{key:"_addCommand",value:function(e,t){e&&e.cmd&&t===L.execute&&this.do(e)}},{key:"id",get:function(){return this.blockId}},{key:"register",value:function(e){!this.undoDispatcher&&e&&e.register(this),this.undoDispatcher=e}},{key:"do",value:function(e){var t=this.undoStack.length;Z<=t&&(this.undoStack=this.undoStack.slice(t-Z));var n=Y.BlockUndoDispatcher.BlockRef;this.undoStack.push(e),this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.do(new n(this.blockId))}},{key:"undo",value:function(){this.undoDispatcher&&this.undoDispatcher.undo()}},{key:"redo",value:function(){this.undoDispatcher&&this.undoDispatcher.redo()}},{key:"clear",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher=null}},{key:"clearAll",value:function(){this.undoStack=[],this.redoStack=[],this.undoDispatcher&&this.undoDispatcher.remove(this)}},{key:"onUndo",value:function(){var e=this.undoStack.pop();e&&(this.redoStack.push(e),this.execCmd(e,L.undo))}},{key:"onRedo",value:function(){var e=this.redoStack.pop();e&&(this.undoStack.push(e),this.execCmd(e,L.redo))}},{key:"onDo",value:function(){this.redoStack=[]}},{key:"clearStack",value:function(){this.undoStack=[],this.redoStack=[]}},{key:"canRedo",value:function(){return!0}},{key:"canUndo",value:function(){return!0}}]),t}()),te=n("vb375"),ne=n("vb53"),re=n("vb764");function ae(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function oe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ae(Object(n),!0).forEach(function(e){O()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ie(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=se(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function se(e,t){if(e){if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(e,t):void 0}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function le(e){for(var t=e.recordMap,n=0,r=Object.keys(t);n<r.length;n++){t[r[n]]={}}return e.reminderMap={},e}function ue(e,t,n){t&&(Qe.set(e,{stdValueTable:t,tableDataSet:null,status:Ue.TO_PASTE,source:He.BITABLE,pasteTableBaseId:""}),le(n))}function de(e,t,n,r,a){t&&(Qe.set(e,{status:Ue.TO_PASTE,source:He.BLOCK,tableDataSet:t,pasteTableBaseId:r,stdValueTable:null,pasteComment:a}),le(n))}var he=function(){function i(e,t,n,r,a,o){var s=this;u()(this,i),this.displayMultiple=t,this.reduxStore=o,this.currentFetchingTableId=null,this.isBitableEditable=!0,this.isDestroy=!1,this.fetchClientvarsQueue=new Map,this.fetchClientvarsResolve=new Map,this.bitableEditableRule=function(){return s.isBitableEditable},this.handleBeforeUnload=function(e){if(s.bitableStore.trySyncIfNeed()){var t="o/";return e.returnValue=t}},this.isBitableReadyAtDisplaySingle=function(e,t){return!s.displayMultiple&&1===e.length&&s.getTableClientVarsLoaded(t)&&!K.DefaultActions.stashedActions[t]},this.isCreateBitableAtDisplaySingle=function(e){return s.bitableStore.base&&s.bitableStore.base.tables&&0<s.bitableStore.base.tables.length&&K.DefaultActions.stashedActions[e]},this.trackBeforeFetchClientVars=function(e){var t=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.InitSmartable;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.InitSmartable},{eventKey:t}),t=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.FetchClientVar,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:t})},this.trackAfterFetchClientVars=function(e,t){var n=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.FetchClientVar;x.TrackerInstance.send(x.TeaEvent.BlockLoaded,{stage:x.BitableBlockLoadedStage.FetchClientVar,gzipSchemaLength:t.gzipSchema.length},{eventKey:n}),n=e[0]+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.DomRender,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:n})},this.handleClientAlreadyLoaded=function(e,t){s.bitableStore.switchTable(e,!s.displayMultiple),t&&t.onClientVarLoaded&&t.onClientVarLoaded(e)},this.fetchBitableClientVars=function(){var a=E()(T.a.mark(function e(a,t,o,i){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.forEach(function(){var t=E()(T.a.mark(function e(t){var n,r;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.getTableClientVarsLoaded(t)){e.next=3;break}return s.handleClientAlreadyLoaded(t,o),e.abrupt("return");case 3:if(!s.fetchClientvarsQueue.get(t)){e.next=10;break}return i&&s.bitableStore.setClientVarRunnerPriority&&s.bitableStore.setClientVarRunnerPriority([t],i),e.next=7,s.waitTableClientVarLoaded(t);case 7:s.handleClientAlreadyLoaded(t,o),e.next=27;break;case 10:return e.prev=10,s.trackBeforeFetchClientVars(a),o&&o.switchTable&&o.switchTable(),e.next=15,s.fetchClientVarsCore(t);case 15:n=e.sent,s.handleFetchClientsSuccess(n,a,t,o),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(10),r=Object(N.a)(e.t0,"ex.code",0),o&&o.onClientVarError&&r!==x.STATUS_CODE.DOCUMENT_KEY_INVALID&&o.onClientVarError(t,r);case 23:return e.prev=23,s.resolveTableClientVarLoaded(t),s.fetchClientvarsQueue.set(t,!1),e.finish(23);case 27:case"end":return e.stop()}},e,null,[[10,19,23,27]])}));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)}));return function(e,t,n,r){return a.apply(this,arguments)}}(),this.handleFetchClientsSuccess=function(e,t,n,r){if(!s.isDestroy){var a=!(s.currentFetchingTableId!==n&&s.bitableStore.isEmbeddedInSheet);s.trackAfterFetchClientVars(t,e),s.bitableStore.handleClientVars(e),a&&s.bitableStore.switchTable(n,!s.displayMultiple),r&&r.onClientVarLoaded&&r.onClientVarLoaded(n),ne.EventEmitter.emit(re.a.LOADED_BITABLE_BLOCK)}},this.fetchClientVarsCore=function(){var t=E()(T.a.mark(function e(t){var n,r,a;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.getViewIdFromUrl()||void 0,r={openType:1,tableId:t,viewId:n},!(a=s.getPreloadDataSync(r))){e.next=5;break}return e.abrupt("return",a);case 5:return e.next=7,s.getPreloadDataAsync(r);case 7:if(a=e.sent,s.fetchClientvarsQueue.set(t,!0),e.t0=a,e.t0){e.next=14;break}return e.next=13,s.bitableStore.getClientVars(r);case 13:e.t0=e.sent;case 14:return a=e.t0,e.abrupt("return",a);case 16:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.getPreloadDataSync=function(e){var t,n=ne.preloadHttp.getData(s.bitableStore.token+"_"+e.tableId);return n&&n.data&&(t=n.data.data),t},this.getPreloadDataAsync=function(){var t=E()(T.a.mark(function e(t){var n,r,a;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=ne.preloadHttp.getData(s.bitableStore.token+"_"+t.tableId))||!n.promise){e.next=12;break}return e.prev=2,e.next=5,n.promise;case 5:a=e.sent,r=a.data,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error("preloadError",e.t0);case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}},e,null,[[2,9]])}));return function(e){return t.apply(this,arguments)}}(),this.enableEdit=function(){s.isBitableEditable=!0,s.bitableStore.getPermissionStore().emitPermissionChange()},this.disableEdit=function(){s.isBitableEditable=!1,s.bitableStore.getPermissionStore().emitPermissionChange()},this.getAllMention=function(){return s.bitableStore.getAllMention()},this.getTableDataForServerCopy=function(e){return s.bitableStore.getTableDataForServerCopy(e)},this.removeLocalConflictRecord=function(){var t=E()(T.a.mark(function e(t){var n;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.bitableStore.getQueueStorage()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.clearBackup();case 5:return e.next=7,n.removeLocalRecord(t);case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.bitableStore=new x.BitableStore(e,ne.IO.getInstance(),n,{resetHook:function(){return x.DriveCoverManger.reset()},permissionSync:!1,needWatch:!0,allowNoTable:n===te.a.EmbeddedInDoc||n===te.a.EmbeddedInSheet},void 0,r,a,{onlyWatchActiveTable:!0}),this.createStorageManager(),this.bitableStore.getPermissionStore().addBasePermissionRules([this.bitableEditableRule],x.OperationType.Editable),window.addEventListener("beforeunload",this.handleBeforeUnload)}return d()(i,[{key:"createStorageManager",value:function(){this.storageManager=this.displayMultiple?new x.DocBitableStorageManager:new x.StorageManager,this.storageManager.bindEvents()}},{key:"waitTableClientVarLoaded",value:function(n){var r=this;return new Promise(function(e){if(r.getTableClientVarsLoaded(n))e();else{var t=r.fetchClientvarsResolve.get(n)||[];t.push(e),r.fetchClientvarsResolve.set(n,t)}})}},{key:"resolveTableClientVarLoaded",value:function(e){var t=this.fetchClientvarsResolve.get(e);t&&t.forEach(function(e){e&&e()})}},{key:"getSource",value:function(){return this.bitableStore}},{key:"getActivedId",value:function(){return this.bitableStore.getActiveTableId()}},{key:"active",value:function(e){var t=this.getIdFromIndex(e);t&&this.bitableStore.switchTable(t)}},{key:"getLength",value:function(){return this.bitableStore.base.tables.length}},{key:"getIndexFromId",value:function(e){return this.bitableStore.base.getTableIndex(e)}},{key:"exists",value:function(e){return this.bitableStore.base.isTableExists(e)}},{key:"getToken",value:function(){return this.bitableStore.base.token}},{key:"getTableClientVarsLoaded",value:function(e){var t=this.bitableStore.base.getTableById(e);return!!t&&t.clientvarLoaded}},{key:"getViewIdFromUrl",value:function(){return Object(x.getAllUrlParams)(location.href).view||null}},{key:"getShowingViewId",value:function(e){var t=this.storageManager.getShowingView(e),n=this.bitableStore.base.getTableById(e);if(n&&n.tableLoaded){var r=n.views;if(t){var a,o=ie(t);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(null!==n.getViewById(i))return i}}catch(e){o.e(e)}finally{o.f()}}return r[0]?r[0].id:void 0}}},{key:"prefetchClientVars",value:function(e,t,n,r,a){var o=this;if(this.currentFetchingTableId=t,this.bitableStore.setNeedWatch(!r),r||(window.bitableStore=this.bitableStore),this.isBitableReadyAtDisplaySingle(e,t))return!r&&this.bitableStore.addToWatchedTableIds(t),void(n&&n.switchTable&&n.switchTable());this.displayMultiple?e.forEach(function(e){return o.bitableStore.initTableEventManager(e)}):this.isCreateBitableAtDisplaySingle(t)&&(K.DefaultActions.stashedActions[t].operations.forEach(function(e){e.actions.forEach(function(e){Object(x.applyBaseAction)(o.bitableStore.base,e,!0)})}),delete K.DefaultActions.stashedActions[t],this.bitableStore.switchTable(t,!this.displayMultiple,!0),n&&n.addNewTable&&n.addNewTable()),this.fetchBitableClientVars(e,t,n,a)}},{key:"isAllLoaded",value:function(){return this.bitableStore.isAllTableLoaded()}},{key:"isLoaded",value:function(e){return this.bitableStore.isTableLoaded(e)}},{key:"setUndoManger",value:function(e){this.bitableStore.getCommandManager().setUndoManager(e)}},{key:"move",value:function(e,t){var n=this.getIdFromIndex(e);n&&this.bitableStore.base.moveTable(n,t)}},{key:"getIdFromIndex",value:function(e){return this.bitableStore.base.tables.length<=e?null:this.bitableStore.base.tables[e].id}},{key:"copy",value:function(e){x.TrackerInstance.start(x.BITABLE_PERFORMANCE_STAGE);var t=this.bitableStore.base,n=t.getTableById(e);if(!n||!n.tableLoaded)return"";var r=Object(x.tableActiveViewIdSelector)(this.reduxStore.getState(),e),a=n.views.findIndex(function(e){return e.id===r}),o={copyType:te.b.Table,tableId:e,snapshot:Object(K.addIndexToTableViewMap)(n.toJSON()),viewIndex:a,baseId:Q()(t.token)},i=JSON.stringify(o);return x.TrackerInstance.send(x.BITABLE_PERFORMANCE_STAGE,{stage:x.BitablePerformanceStage.CopyParsing,fields_num:Object.keys(n.fields).length,records_num:Object.keys(n.records).length}),i}},{key:"handleCSV",value:function(e){var t=this.bitableStore.base.getTableById(e),n=Object(x.tableActiveViewIdSelector)(this.reduxStore.getState(),e),r=t.views.filter(function(e){return e.id===n}),a=H()(r,1)[0],o=a.getAllFields(),i=a.getVisibleRecords(),s=a.getStdValueTableFromRange([{row:0,col:0,rowCount:i.length,colCount:o.length}]);return Object(x.exportCSVData)(s)}},{key:"applyActions",value:function(e,t){var r=this;e.forEach(function(e){var t=r.bitableStore.getSyncTable(e.id);if(t){var n=t.engine;n.applyChangeset(n.getModel(),e)}})}},{key:"freeze",value:function(){this.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.bitableStore.unfreeze()}},{key:"suspend",value:function(e){this.bitableStore.stopQueue()}},{key:"resume",value:function(e){this.bitableStore.restartQueue()}},{key:"destroy",value:function(){this.isDestroy=!0,window.removeEventListener("beforeunload",this.handleBeforeUnload),K.DefaultActions.clearStashedActions(),this.bitableStore.getPermissionStore().removeBasePermissionRule(this.bitableEditableRule,x.OperationType.Editable),this.bitableStore.reset(),this.reduxStore.dispatch(Object(x.resetRedux)()),window.bitableStore=null}},{key:"fetchTableToMaxVersion",value:function(e,t){this.bitableStore.fetchTableToMaxVersion(e,t)}},{key:"getStorageManager",value:function(){return this.storageManager}}],[{key:"addTable",value:function(e){return K.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Grid)}},{key:"addKanban",value:function(e){return K.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Kanban)}},{key:"addGantt",value:function(e){return K.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Gantt)}},{key:"addGallery",value:function(e){return K.DefaultActions.addTable(e,te.a.EmbeddedInDoc,x.ViewType.Gallery)}},{key:"paste",value:function(e,t,n,r){var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],o=5<arguments.length?arguments[5]:void 0;x.TrackerInstance.start(x.BitablePerformanceStage.PasteParsing);var i,s,c=Object(x.getNewId)(x.IDPrefix.table,[]);try{s=JSON.parse(e)}catch(e){return console.error(e),null}var l=!1;if(s.copyType===te.b.Table){var u=s,d=u.snapshot,h=u.viewIndex,b=u.baseId,f=[];d.views.forEach(function(e,t){var n=Object(x.getNewId)(x.IDPrefix.view,[]);d.viewMap[n]=d.viewMap[e],d.viewMap[n].id=n,delete d.viewMap[e],f.push(n)}),d.views=f;var v=d.views[h];d.viewMap[v]&&n&&de(c,Object(W.a)(d),d,b,r),i=oe({},d,{id:c,name:Object(x.getCopyTableName)([],d.name),viewMap:Object(z.a)(d.viewMap,function(e){return oe({},e,{owner:""})})}),Object(x.adjustSnapshotOnCopy)(i,d,n,o),l=0!==d.rev||!(!d.exInfo||!d.exInfo.contentCreation)}else{i=K.DefaultActions.jsonToCS(e),ue(c,x.Serializer.json.parse(e),i)}x.TrackerInstance.send(x.BITABLE_PERFORMANCE_STAGE,{stage:x.BitablePerformanceStage.PasteParsing,copyType:s.copyType,fields_num:Object.keys(i.fieldMap).length,records_num:Object.keys(i.recordMap).length});var p=c+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.Done;x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:p}),p=c+"_"+x.TeaEvent.BlockLoaded+"_"+x.BitableBlockLoadedStage.GetToken,x.TrackerInstance.start(x.TeaEvent.BlockLoaded,{},{eventKey:p});var m=i.recordMeta,g=i,y=g.viewMap,S=g.recordMap,C=g.fieldMap,k=g.userMap,T=g.resourceMap,w=g.reminderMap,E=g.milestoneMap,I={tableId:c,viewMap:y,recordMap:S,fieldMap:C,userMap:k,memberId:t,contentCreation:l,recordMeta:m,resetRecordMeta:a,reminderMap:w,resourceMap:T,milestoneMap:void 0===E?{}:E};return Object(K.generateAddTableCs)(I)}},{key:"genPasteBitaleSnapshot",value:function(e,t,n){var r,a=!1;if(t.copyType===te.b.Table){var o=t.snapshot;r=this.genCopyTypeSnapshot(t,n,!0),a=0!==o.rev||!(!o.exInfo||!o.exInfo.contentCreation)}else r=K.DefaultActions.jsonToCS(e);return{snapshot:r,contentCreation:a}}},{key:"genCopyTypeSnapshot",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=e.snapshot,a=[];r.views.forEach(function(e,t){var n=Object(x.getNewId)(x.IDPrefix.view,[]);r.viewMap[n]=r.viewMap[e],r.viewMap[n].id=n,delete r.viewMap[e],a.push(n)}),r.views=a;var o=oe({},r,{id:t,name:Object(x.getCopyTableName)([],r.name),viewMap:Object(z.a)(r.viewMap,function(e){return oe({},e,{owner:""})})});return Object(x.adjustSnapshotOnCopy)(o,r,n),o}}]),i}(),be=function(s){function l(e,t,n,r,a,o){var c;u()(this,l);var i=function(e){return new he(e,n,r,t,a,o)};return(c=s.call(this,e,new ee,i,t,function(e){return e.operations.some(function(e){return e.command===x.CollaCommands.AddTable})},n)||this).recoverTableHistory=function(n){if(!n)return Promise.reject("recoverTableHistory no snapshot");var a=c.dataSource.getSource(),o=n.id,i=a.getCommandManager(),s=a.base.getTableById(o);return new Promise(function(r,e){var t=function e(t){var n=s&&t.changesets[0].rev>=s.rev;t.token===o&&n&&(a.removeEventListeners(o,O()({},x.Events.ChangesetApplied,e)),a.fetchClientVars({tableId:o}),r())};a.addEventListeners(o,O()({},x.Events.ChangesetApplied,t)),i.execute({cmd:x.CollaCommands.RecoverTableHistory,tableId:o,data:{revision:n.rev,snapshot:n}}),setTimeout(e,5e3)})},c}return p()(l,s),d()(l,[{key:"key",get:function(){return""}}],[{key:"getActiveViewIdMap",value:function(){return Object(N.a)(ne.store.getState(),"bitable.Tables.activeViewIdMap",null)}},{key:"paste",value:function(e,t,n,r){var a=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],o=5<arguments.length?arguments[5]:void 0;return he.paste(e,t,n,r,a,o)}},{key:"genPasteBitaleSnapshot",value:function(e,t,n){return he.genPasteBitaleSnapshot(e,t,n)}},{key:"addTable",value:function(e){return he.addTable(e)}},{key:"addKanban",value:function(e){return he.addKanban(e)}},{key:"addGantt",value:function(e){return he.addGantt(e)}},{key:"addGallery",value:function(e){return he.addGallery(e)}}]),l}(q),fe=n("vb58"),ve=n.n(fe),pe=n("vb1209"),me=n("vb594"),ge=n("vb90"),ye=(n("vb765"),function(t){function r(e){var n;return u()(this,r),(n=t.call(this,e)||this).setHistory=function(){},n.loadedTable=function(e){n.renderer.loadedTable(e)},n.switchTable=function(e){n.historyModeTableId=e,n.forceUpdate()},n.addNewTable=function(e){var t=n.bitableStore.base;ne.store.dispatch(Object(x.updateTables)(t)),n.renderer.addNewTable(t,e),n.setState({delayLoading:!0},function(){requestAnimationFrame(function(){return n.state.delayLoading&&n.setState({delayLoading:!1})})})},n}return p()(r,t),d()(r,[{key:"componentDidMount",value:function(){y()(S()(r.prototype),"componentDidMount",this).call(this)}},{key:"componentDidUpdate",value:function(e){y()(S()(r.prototype),"componentDidUpdate",this).call(this,e),this.props.onLoaded&&!this._onMountFired&&(this._onMountFired=!0,this.props.onLoaded())}},{key:"previewHistory",value:function(e,t){var a=this,o=e.revInfo,n=e.changesets,r=t?t.activeTableId:void 0;this.revInfo=o,this.localChangesets=n,r&&o[r]||Object.keys(o).forEach(function(e){0===o[e].lastRev&&(r=e)}),r?this.historyModeTableId=r:Object.keys(o).forEach(function(e){var t=o[e],n=t.lastRev,r=t.firstRev;Number.isInteger(n)&&Number.isInteger(r)&&(a.historyModeTableId=e)}),this.forceUpdate()}},{key:"exitHistory",value:function(){y()(S()(r.prototype),"exitHistory",this).call(this)}},{key:"render",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.activeTableId,a=this.bitableStore.base.getOrderedInfos(),o=this.state,i=o.suspend,s=o.height;return i?null:ve.a.createElement(x.EmbeddedBitableHistoryForSheet,{token:n,io:t.io,key:this.historyModeTableId||r,bitableBase:t.base.toJSON(),activeTableId:this.historyModeTableId||r,hideTab:!0,hideList:!0,hideHeader:!0,height:s,revInfo:this.revInfo,orderedInfos:a,store:this.props.store,localChangesets:this.localChangesets})}}]),r}(me.a)),Se=Object(ge.connect)(function(e){return{tableId:Object(x.activeTableIdSelector)(e),viewId:Object(x.activeViewIdSelector)(e)}})(ye),Ce=n("vb767"),ke=n("vb516"),Te=n("vb676"),we=n("vb677"),Ee=n("vb395"),Ie=(n("vb525"),n("vb597"),n("vb1216")),Oe=n("vb678"),Me=n("vb119"),Be=n("vb309"),De=n.n(Be),xe=n("vb200"),Ae=n("vb143"),Pe=n.n(Ae);function Re(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _e(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Re(Object(n),!0).forEach(function(e){O()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Le=function(t){function g(e){var d;return u()(this,g),(d=t.call(this,e)||this).highlightInfos={},d.historyPreviewOption={isHighlight:!0,users:{}},d.highlightRangeMap={},d.isShowAllHistoryLabels=!1,d.setOffsetXPromise=new Promise(function(e){return d.setOffsetXResolve=e}),d.onOffsetLeftChange=function(e){d.props.shell.onRectChange&&d.props.shell.onRectChange(e)},d.onHoverCellChange=function(c){if(d.historyPreviewOption.isHighlight&&!d.isShowAllHistoryLabels){var e=d.highlightInfos[c.tableId],t=e?e.cells:[],l=d.renderer.activeBitableWidget.getActiveWidget(),u=d.renderer.getActiveView();if(u)De()(t).reverse().some(function(e){var t=e.recordId,n=e.fieldId,r=e.userId,a=t?u.getVisibleRecordIndexById(t):-1,o=n?u.getFieldIndexById(n):-1,i=r?d.historyPreviewOption.users[r]:void 0;if(n&&!t&&o===c.col||t&&!n&&a===c.row||a===c.row&&o===c.col){var s=Object(x.findTextRange)(d.highlightRangeMap[c.tableId],c.row,c.col);if(s&&i)return l.showHistoryLabels([{col:s.col,row:s.row,bgColor:i.labelColor,color:"static-white",text:Object(x.getUserName)(i),name:Object(x.getUserName)(i)}]),!0}return!1})||l.showHistoryLabels([])}},d.state=_e({},d.state,{isLoaded:!1}),d}return p()(g,t),d()(g,[{key:"getTable",value:function(){var e=this.props,t=e.bitableStore,n=e.tableId;return t.base.getTableById(n)}},{key:"setOffsetX",value:function(e){y()(S()(g.prototype),"setOffsetX",this).call(this,e),this.setOffsetXResolve()}},{key:"fetchTableData",value:function(){var n=E()(T.a.mark(function e(t,n){var r,a,o,i,s,c,l;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(x.getHistoryPrivider)();case 2:return r=e.sent,a=n.lastRev,o=this.props.bitableStore,i=r.getInstance(o),s=n.firstRev?n.firstRev:n.lastRev,e.next=9,i.fetchHistoryMeta(t,s);case 9:if(c=e.sent,n===this.activeTableRevInfo){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,i.fetchHistoryChangesets(t,c.rev,a);case 14:if(l=e.sent,n===this.activeTableRevInfo){e.next=17;break}return e.abrupt("return",null);case 17:return e.abrupt("return",{snapshot:c,changesets:l});case 18:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"applyChangesets",value:function(t,e,n,r){var a,o=this.props.bitableStore;r&&n<=t.rev&&(a=t.toJSON());var i=[];e.forEach(function(e){Object(x.applyHistoryChangeset)(o.base,e,x.ActionTypes.Table,t.id),r&&(n===e.rev?a=t.toJSON():e.rev>n&&i.push(e))});var s=null,c=this.renderer.getShowingViewId(t.id)||"";return r&&0<i.length&&(s=Object(x.getHistoryHighlightInfo)(Object(x.combineChangesets)(i),a,c)),s}},{key:"highlight",value:function(e){var t=this.renderer.activeBitableWidget,n=t.getActiveWidget(),r=this.historyPreviewOption.users||{};if(t.events.removeListener(x.CommonEvents.CellHover,this.onHoverCellChange),n){Object(x.clearHistoryHighlight)(n);var a=this.renderer.getShowingViewId(this.props.tableId);if(!a)return;var o=this.getTable().getViewById(a);if(e&&e.cells&&e.cells.length&&(e.cells.forEach(function(e){var t=e.userId?r[e.userId]:void 0;t&&(e.textColor=t.textColor,e.labelColor=t.labelColor,e.color=t.bgColor,e.text=Object(x.getUserName)(t))}),t.events.addListener(x.CommonEvents.CellHover,this.onHoverCellChange)),e&&e.cells){var i=Object(x.updateHistoryHighlight)(n,e.cells,!1,!1);i&&o&&o.type===x.ViewType.Grid&&(this.highlightRangeMap[n.getTableId()]=i)}}}},{key:"onLoaded",value:function(){var e=this.props.onLoaded;!this._onMountFired&&e&&(this._onMountFired=!0,e())}},{key:"previewHistory",value:function(){var n=E()(T.a.mark(function e(t,n){var r,a,o,i,s,c,l,u,d,h,b,f,v,p,m=this;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y()(S()(g.prototype),"previewHistory",this).call(this,t,n),r=t.revInfo,a=(n||{}).isHighlight,o=void 0!==a&&a,i=this.props,s=i.bitableStore,c=i.tableId,l=i.updateTables,u=r[c]){e.next=7;break}return e.abrupt("return");case 7:return s.Options.module="history",this.setState({isLoaded:!1}),this.activeTableRevInfo=u,d=this.getTable(),e.next=13,this.fetchTableData(c,u);case 13:if(h=e.sent){e.next=16;break}return e.abrupt("return");case 16:return b=h.snapshot,f=h.changesets,d.records={},d.fromJSON(b),d.status=x.TableLoadStatus.TableLoaded,v=this.applyChangesets(d,f,u.firstRev||0,!0),l(s.base),e.next=24,new Promise(function(e){return m.setState({isLoaded:!0},e)});case 24:return p=this.renderer.getShowingViewId(c)||"",this.embedBitableRef&&this.embedBitableRef.applyFasterView(c,p),this.onLoaded(),this.historyPreviewOption=n,e.next=30,this.setOffsetXPromise;case 30:v&&(this.highlightInfos[d.id]=v,o&&this.highlight(v)),this.props.mountOption.onHistoryResultReady&&Object(xe.a)(u.firstRev)&&u.firstRev!==u.lastRev&&this.props.mountOption.onHistoryResultReady([this.props.tableId]),this.renderer.activeBitableWidget.events.addListener(x.CommonEvents.EmbedOffsetLeftChanged,this.onOffsetLeftChange);case 33:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"locate",value:function(e){var t=this.renderer.getShowingViewId(this.props.tableId);if(t){var n=this.getTable(),r=n.getViewById(t);if(r){var a;if(r.type===x.ViewType.Grid){var o=this.highlightRangeMap[n.id].keys().next().value;if(o){var i=o.split(","),s=H()(i,2),c=s[0],l=s[1];a={area:x.SearchHighlightArea.GridBody,row:parseInt(c,10),col:parseInt(l,10)}}else a={area:x.SearchHighlightArea.GridBody,row:1,col:0}}else{var u=this.highlightInfos[n.id],d=u?u.cells.filter(function(e){return e.recordId})[0]:void 0;a={area:x.SearchHighlightArea.KanbanCard,recordId:d?d.recordId:r.getVisibleRecords()[0]}}var h=this.getEtherpadWrapper(),b=this.renderer.activeBitableWidget.getActiveWidget();h&&this.bitableRef&&b&&Object(x.scrollInDoc)(h,this.bitableRef,b,e,a),this.showAllHistoryLabels()}}}},{key:"highlightHistory",value:function(e){var t=this.getTable(),n=this.highlightInfos[t.id];this.highlight(null),this.historyPreviewOption=e,n&&e.isHighlight&&this.highlight(this.highlightInfos[t.id])}},{key:"showAllHistoryLabels",value:function(){var e=this.getTable(),t=this.renderer.activeBitableWidget.getActiveWidget(),n=this.highlightInfos[e.id];this.isShowAllHistoryLabels=!0,t&&Object(x.showAllHistoryLabels)(t,n,this.historyPreviewOption.users)}},{key:"clearHistoryLabel",value:function(){var e=this.renderer.activeBitableWidget.getActiveWidget();this.isShowAllHistoryLabels=!1,e&&Object(x.clearHistoryLabel)(e)}},{key:"componentWillUnmount",value:function(){var e=this.renderer.activeBitableWidget;e&&e.events.removeListener("EmbedOffsetLeftChanged",this.onOffsetLeftChange),y()(S()(g.prototype),"componentWillUnmount",this).call(this),this.renderer.reset(),this.bitableStore.reset()}},{key:"render",value:function(){var t=this,e=this.props,n=e.bitableStore,r=e.table,a=e.view,o=e.views,i=e.tableId,s=e.viewId,c=e.isFullScreenMode,l=e.shell,u=e.editbarPinChanged,d=e.mountOption,h=this.state,b=h.maxWidth,f=h.maxHeight,v=h.offsetX,p=h.isSelect,m=h.docWidth,g=h.delayLoading,y=h.collapsed,S=h.zoom,C=h.isLoaded,k=d.overlayContainer;return C?ve.a.createElement("div",{className:Pe()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":c}),ref:function(e){return t.bitableRef=e}},!c&&k?B.a.createPortal(this.renderOverlay(),k):null,a&&ve.a.createElement(x.TableView,{bitableStore:n,renderer:this.renderer,smartableCommentManager:null,tableId:i,viewId:s,table:r,view:a,views:o,shell:l,maxWidth:b,maxHeight:f,offsetX:c?20:v,docWidth:m,isSelect:p,editbarPinChanged:u,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:c,mountOption:d,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:S,ref:this.setBitableRef,delayLoading:g,collapsed:y})):null}}],[{key:"getDerivedStateFromProps",value:function(e){var t=e.bitableStore,n=e.tableId;if(!t.base.getTableById(n)){var r=new x.Table(n,"");r.setBase(t.base),t.base.tables.push(r)}return{}}}]),g}(Ce.b),je=Object(ge.connect)(function(e,t){var n=t.tableId;return{tableId:n,table:Object(x.tableSelector)(e,n),view:Object(x.tableViewSelector)(e,n,Object(x.tableActiveViewIdSelector)(e,n)),views:Object(x.tableViewsSelector)(e,n),viewId:Object(x.tableActiveViewIdSelector)(e,n),showFloatToolbar:Object(x.floatToolbarVisibilitySelector)(e,n),isEditing:Object(x.editingSelector)(e,n),fullScreenTableId:Object(x.getFullScreenTableId)(e)}},{setFullScreenTableId:x.setFullScreenTableId,setFloatToolbarTable:x.setFloatToolbarTable,updateTables:x.updateTables})(Le),Fe=n("vb104");n.d(t,"BitableToPasteStatus",function(){return Ue}),n.d(t,"BitablePasteSource",function(){return He}),n.d(t,"bitableToPaste",function(){return Qe}),n.d(t,"EmbeddedBitableManager",function(){return qe}),n.d(t,"NEW_VIEW_RECORD_COUNT_IN_DOC",function(){return K.NEW_VIEW_RECORD_COUNT_IN_DOC}),n.d(t,"NEW_VIEW_FIELD_MAP_IN_DOC",function(){return K.NEW_VIEW_FIELD_MAP_IN_DOC}),n.d(t,"addIndexToTableViewMap",function(){return K.addIndexToTableViewMap}),n.d(t,"generateAddTableCs",function(){return K.generateAddTableCs}),n.d(t,"DefaultActions",function(){return K.DefaultActions});var Ue,Ve,He,Ne,We=function(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":g()(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(a=e[s])&&(i=(o<3?a(i):3<o?a(t,n,i):a(t,n))||i);return 3<o&&i&&Object.defineProperty(t,n,i),i},ze=Object(x.getBitableModule)(),Ke=Object(x.getAloneBitableModule)(),Ge=240,Xe=0;function Je(e){if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(Ve=Ue||(Ue={})).TO_PASTE="toPaste",Ve.PASTING="pasting",Ve.PASTED="pasted",(Ne=He||(He={})).BLOCK="BLOCK",Ne.BITABLE="BITABLE";var Qe=new Map,qe=function(o){function i(e,t,n,r){var c,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:ne.store;return u()(this,i),(c=o.call(this,e,n===te.a.EmbeddedInDoc,t,n,r,a)||this).hostType=n,c.blockExtraFunctions=r,c.reduxStore=a,c.docFullScreenWrapper=null,c.fullScreenTableId=null,c.openVCFollow=function(){Object(x.enableModuleFollowState)(x.BitableFollowModule.BitableFullScreen,c.replayVCFollowState),c.sendVCStateChange(c.getVCFollowState())},c.closeVCFollow=function(){Object(x.closeModuleFollow)(x.BitableFollowModule.BitableFullScreen,c.replayVCFollowState)},c.sendVCStateChange=function(e){Object(x.sendFollowState)(x.BitableFollowModule.BitableFullScreen,e)},c.getVCFollowState=function(){return{fullscreen:c.fullScreenTableId}},c.enterDocFullScreen=function(o){c.docFullScreenWrapper&&c.exitDocFullScreen(),x.BitableDep.CommonUtil.closeDocFindReplaceBox(c.reduxStore),x.BitableDep.CommonUtil.banDocFindReplaceBox(!0);var e=Te.a.createForFullScreen(!1);e.className+=" bitable-doc-fullscreen-wrapper",c.docFullScreenWrapper=e;var t=c.contentManager.dataSource.getSource(),n=c.contentManager.dataSource.getStorageManager(),r=c.mountOptions[o];c.fullScreenTableId=o;var a,i=Object(ke.a)(),s=c.contentPersenters.get(o);s&&(a=s.getSmartableCommentManager(o)),c.sendVCStateChange(c.getVCFollowState()),c.enterDocFullScreenTimer=Object(we.a)(function(){B.a.render(ve.a.createElement(ge.Provider,{store:c.reduxStore},ve.a.createElement(Me.Router,{history:i},ve.a.createElement(Ce.a,{history:Object(ke.a)(),isFullScreenMode:!0,token:c.token,store:c.reduxStore,bitableStore:t,storageManager:n,tableId:o,maxWidth:window.innerWidth,mountOption:r,smartableCommentManager:a,offsetX:0,shell:{onDeleteSheet:function(){},onSizeAndScrollChange:function(e,t,n,r,a){c.internalSizeChanged(o,t,e,n,r,a)},onRenderError:function(){},onScreenShotReady:function(e){},onCutWholeSheet:function(e){},onContextMenuComment:function(){},exitFullScreenMode:c.exitDocFullScreen}}))),e)})},c.exitDocFullScreen=function(){c.enterDocFullScreenTimer&&Object(we.b)(c.enterDocFullScreenTimer),x.BitableDep.CommonUtil.banDocFindReplaceBox(!1);var e=h()(c).docFullScreenWrapper;c.fullScreenTableId=null,c.sendVCStateChange(c.getVCFollowState()),e&&(B.a.unmountComponentAtNode(e),Te.a.remove(e),c.docFullScreenWrapper=null)},c.isManagerDestroyed=function(){return c.isDestroyed},x.BitableDep.store&&(c.oldBitableDepStore=x.BitableDep.store),x.BitableDep.store=a,c.openVCFollow(),c}return p()(i,o),d()(i,[{key:"replayVCFollowState",value:function(e){var t=e.data.fullscreen;if(this.fullScreenTableId===t)return{status:x.ReplayStatus.Success};if(t){if(!this.contentPersenters.get(t))return{status:x.ReplayStatus.Fail,code:x.ReplayCode.NotExist};this.enterDocFullScreen(t)}else this.exitDocFullScreen();return{status:x.ReplayStatus.Success}}},{key:"bitableDepRevert",value:function(){this.oldBitableDepStore&&(x.BitableDep.store=this.oldBitableDepStore,delete this.oldBitableDepStore)}},{key:"destroy",value:function(){y()(S()(i.prototype),"destroy",this).call(this),this.bitableDepRevert(),this.closeVCFollow()}},{key:"createContentManager",value:function(){var e=this;return new be(this.token,function(){return e.getOrders()},this.displayMultiple,this.hostType,this.blockExtraFunctions,this.reduxStore)}},{key:"getAction",value:function(e,t){var n=this.contentManager.dataSource.getSource();switch(e){case s.Add:case s.Paste:return K.DefaultActions.addTable(n.getMemberId(),te.a.EmbeddedInDoc);case s.Del:var r=t;return K.DefaultActions.delTable(r,this.contentManager.dataSource.getIndexFromId(r));default:throw new Error("Not support action type")}}},{key:"unmountContentPresenter",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.bitableDepRevert(),e===this.fullScreenTableId&&this.exitDocFullScreen(),y()(S()(i.prototype),"unmountContentPresenter",this).call(this,e,t)}},{key:"createSheetShell",value:function(){return{onScreenShotReady:C.a}}},{key:"createDocShell",value:function(o){var i=this,t=this.mountOptions[o];return{onDeleteSheet:C.a,onFullScreenMode:this.enterDocFullScreen,onSizeAndScrollChange:function(e,t,n,r,a){i.internalSizeChanged(o,t,e,n,r,a)},onRenderError:C.a,onScreenShotReady:C.a,onCutWholeSheet:C.a,onContextMenuComment:C.a,onHeightWillUpdate:function(){t.onHeightWillUpdate&&t.onHeightWillUpdate()},onHeightDidUpdate:function(){t.onHeightDidUpdate&&t.onHeightDidUpdate()},onRectChange:function(e){t.onRectChange&&t.onRectChange(e)}}}},{key:"onDocEnterBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.resume()}},{key:"onDocLeaveBuffer",value:function(e){var t=this.contentPersenters.get(e);t&&t.suspend()}},{key:"createHistoryEmbeddedComponent",value:function(t,n,e,r){var a=this,o=this.reduxStore.getState(),i=Object(Oe.a)(o),s=this.contentManager.dataSource.getSource(),c=this.contentManager.dataSource.getStorageManager(),l=this.uiManager.getContainerSize(),u=this.uiManager.getWidth(),d=this.uiManager.getDocWidth(),h=this.mountOptions[t];return ve.a.createElement(ge.Provider,{store:i},ve.a.createElement("div",{className:s.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},s.isEmbeddedInSheet&&ve.a.createElement(Se,{token:this.token,bitableStore:s,storageManager:c,store:i,tableId:t,activeTableId:t,mountOption:h,height:this.uiManager.getHeight(),onMount:function(e){return n(e)},onRecover:h.operator.onRecover,onLoaded:function(){return e(r,s)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return a.onDataChanged(e)},shell:this.createSheetShell()}),s.isEmbeddedInDoc&&ve.a.createElement(je,{token:this.token,width:u,maxWidth:l[t]?l[t].width:Ge,offsetX:l[t]?l[t].offsetX:Xe,docWidth:d,initViewIdIndex:r&&r.option&&r.option.viewIndex||0,bitableStore:s,storageManager:c,tableId:t,mountOption:h,onMount:function(e){return n(e)},onLoaded:function(){return e(r,s)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){a.editbarPinChanged(t,e)},onChanged:function(e){return a.onDataChanged(e)},shell:this.createDocShell(t),store:i})))}},{key:"createEmbeddedComponent",value:function(t,n,e,r){var a=this,o=this.contentManager.dataSource.getSource(),i=this.contentManager.dataSource.getStorageManager(),s=o.base,c=s.getTrashTableById(t);if(c){s.recoverTable(t,{index:-1,name:c.name});var l=n;n=function(){l.apply(void 0,arguments),a.reduxStore.dispatch(Object(x.updateTables)(s)),a.reduxStore.dispatch(Object(x.setBitableStage)(x.BitableStage.READY))}}var u=this.uiManager.getContainerSize(),d=this.uiManager.getWidth(),h=this.uiManager.getDocWidth(),b=this.uiManager.getActionTypeMap().get(t)||0,f=this.mountOptions[t];if(f.isHistoryMode)return this.createHistoryEmbeddedComponent(t,n,e,r);var v=Object(ke.a)();return ve.a.createElement(ge.Provider,{store:this.reduxStore},ve.a.createElement(Me.Router,{history:v},ve.a.createElement("div",{className:o.isEmbeddedInSheet?"bitable-in-sheet__component-wrapper":""},o.isEmbeddedInSheet?ve.a.createElement(Ee.DynamicModuleLoader,{modules:[Ke]},ve.a.createElement(pe.a,{history:v,token:this.token,bitableStore:o,storageManager:i,tableId:t,activeTableId:t,mountOption:f,height:this.uiManager.getHeight(),onMount:function(e){return n(e)},onRecover:f.operator.onRecover,onLoaded:function(){return e(r,o)},onTableChangedInUndo:this.onTableChangedInUndo,onChanged:function(e){return a.onDataChanged(e)},shell:this.createSheetShell(),store:this.reduxStore})):null,o.isEmbeddedInDoc?ve.a.createElement(Ee.DynamicModuleLoader,{modules:[ze]},ve.a.createElement(Ce.a,{isManagerDestroyed:this.isManagerDestroyed,history:Object(ke.a)(),token:this.token,width:d,commentActionType:b,maxWidth:u[t]?u[t].width:Ge,offsetX:u[t]?u[t].offsetX:Xe,docWidth:h,initViewIdIndex:r&&r.option&&r.option.viewIndex||0,bitableStore:o,storageManager:i,tableId:t,mountOption:f,onMount:function(e){return n(e)},onLoaded:function(){return e(r,o)},onTableChangedInUndo:this.onTableChangedInUndo,internalSizeChanged:this.internalSizeChanged,editbarPinChanged:function(e){a.editbarPinChanged(t,e)},onChanged:function(e){return a.onDataChanged(e)},shell:this.createDocShell(t),store:this.reduxStore,zoom:this.uiManager.getZoom()})):null)))}}],[{key:"pasteBitableWithoutBridge",value:function(e,t,n,r){return be.paste(e,t,n,r)}},{key:"getInitCSWithoutBridge",value:function(e){return be.addTable(e)}},{key:"getInitKanbanCSWithoutBridge",value:function(e){return be.addKanban(e)}},{key:"getInitGanttCSWithoutBridge",value:function(e){return be.addGantt(e)}},{key:"getInitGalleryCSWithoutBridge",value:function(e){return be.addGallery(e)}},{key:"getBitablePasteDataWithoutBridge",value:function(e){var t=e.dataset.byteBitable;if(!t)return"";if(Je(t))return t;try{return t=Ie.Base64.decode(t),x.BitableDep.collectBitableEvent("bitable_doc_paste_base64_data",{scm_version:JSON.stringify(window.scm||{}),scm_bitable:JSON.stringify(window.scmbitable||{}),source:"paste_bitable_cells"}),t}catch(e){var n=e.stack||e.toString();return x.BitableDep.collectBitableEvent("bitable_doc_paste_error",{name:e.name,stack:n||"",info:e.message}),""}}}]),i}(U);We([Object(Fe.Bind)(),x.VCFollowReplayDecorator],qe.prototype,"replayVCFollowState",null)},vb1211:function(e,t,n){},vb1212:function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return b}),n.d(t,"c",function(){return f});var r,a,o=n("vb53"),i=n("vb174"),s=n.n(i);(a=r||(r={}))[a.UNDEFINED=0]="UNDEFINED",a[a.FEED=1]="FEED",a[a.ANNOUNCE=2]="ANNOUNCE",a[a.MINUTE=3]="MINUTE";var c="report";function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return s.a.parseUrl(e).query}function u(e){if(!o.browser.isFeed)return 0;var t=+e.lark||1;switch(e.open_type){case"announce":t=r.ANNOUNCE;break;case"meeting_notes":t=r.MINUTE}return t}function d(e){return u(l(e))}function h(){return d(location.href)===r.ANNOUNCE}function b(){var e=l(location.href);return!!e&&e.open_type===c}function f(){return"true"===l(window.location.search).hideCommentBtn}},vb1213:function(e,h,b){"use strict";(function(r){b.d(h,"a",function(){return d});var e=b("vb273"),a=b.n(e),t=b("vb274"),o=b.n(t),n=b("vb284"),i=b.n(n),s=b("vb58"),c=b.n(s),l=b("vb1214"),u=(b("vb1215"),b("vb114")),d=function(t){function n(){var e;return a()(this,n),(e=t.apply(this,arguments)||this).blockInfo=function(e){var t=r("bitable.bitable");return e===u.EErrorCodeType.copyError?r("CreationDoc_DocX_duplicate_block_failed_content",t):t+r("CreationDoc_Docs_Diagram.LoadingFailed.Desc")},e}return i()(n,t),o()(n,[{key:"componentDidMount",value:function(){var e=this.props.errorCodeType,t=void 0===e?u.EErrorCodeType.dataError:e;u.BitableDep.collectBitableEvent("client_bitable_in_doc_error_block",{block_type:t})}},{key:"render",value:function(){var e=this.props,t=e.errorCodeType,n=void 0===t?u.EErrorCodeType.dataError:t,r=e.offsetX;return c.a.createElement("div",{className:"block-error-view",style:{marginLeft:r}},c.a.createElement("div",{className:"block-error-view-img"},c.a.createElement(l.a,null)),c.a.createElement("div",{className:"block-error-view-text"},this.blockInfo(n)))}}]),n}(c.a.Component)}).call(this,b("vb152"))},vb1214:function(e,t,n){"use strict";var r=n("vb432"),a=n.n(r),o=n("vb58"),i=n.n(o);function s(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.a=function(e){e.styles;var t=s(e,["styles"]);return i.a.createElement("svg",a()({width:"88",height:"88",viewBox:"0 0 88 88",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.a.createElement("g",{clipPath:"url(#6dd800fc94d8ef6d718de2ecabdae5e2-a)"},i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.62 32.08l-1.5 6.01-22.78 7.52s-1.2-5.41 9.89-12.03c4.22-2.52 1.73-3.84.9-4.81-1.8-2.1.6-3.6 4.2-5.11 3.58-1.5 0-3.01-.6-5.87-.6-2.85 4.8-9.77 11.39-11.28 6.59-1.5 16.66-.81 15.28 10.23-.3 2.4-.6 4.21-.6 4.21s-.6-2.1-3-1.2c-1.94.73-.9 2.1-3.6 0-2.39-1.2-5.39-3.91-5.09-7.52-1.8 2.7-3.3 5.41-6.9 6.61-.9 10.83 2.4 13.24 2.4 13.24z",fill:"#18263C"}),i.a.createElement("path",{d:"M48.7 24.86s5.1-.3 4.8-3.6c-.3-3.32-4.2-.31-4.2-.31M35.22 18.54s-1.3 14.25 5.1 14.44",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),i.a.createElement("path",{d:"M13.64 45.31l22.48-7.22 1.5-5.71M26.12 44.06s4.03 14.03 17.06 10.22c13.04-3.8 10.67-19.5 10.67-19.5M42.11 11.93c-.6.3-1.5 5.11-8.69 7.52M49 20.95s-5.69-2.7-6.29-6.32",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.88 23.12c-.43.43-1.12.43-1.54 0a1.1 1.1 0 0 1 0-1.55 1.09 1.09 0 0 1 1.54 0 1.1 1.1 0 0 1 0 1.55zM45.52 22.86a1.1 1.1 0 1 1-2.19 0 1.1 1.1 0 0 1 2.19 0z",fill:"#18263C"}),i.a.createElement("path",{d:"M40.91 28.47l-1.8.3 1.5-6.62",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"}),i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M53.2 22.75l-1.5 9.63-5.7 2.1v-3.9s2.4-4.22 2.7-5.42c0 0 1.61-.42 2.1-.6.65-.24 2.4-1.8 2.4-1.8z",fill:"#18263C"}),i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.32 74.01h61.4V30.1H9.31V74z",fill:"#D6DAE1"}),i.a.createElement("path",{d:"M39.54 29.57l-2.83 22.22h5.67l-3.3 22.22",stroke:"#fff"}),i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M62.73 30h7.9v-3.95h-7.9V30z",fill:"#FFC200"}),i.a.createElement("path",{d:"M.53 42.48l4.93-.41c4.98-.42 11.21-8.34 14.12-7.92 2.9.41-4.15 6.25-1.66 9.17 2.78 3.25 16.2-.84 15.78 2.91-.41 3.75-15.36 5-15.78 2.92-.41-2.08 17.86 0 17.86 3.75s-17.86 3.34-18.27 1.67c-.42-1.67 15.78.42 15.78 3.75s-16.62 3.33-17.03 1.67c-.42-1.67 14.56 1.13 14.12 3.33-.83 4.17-30.26 2.5-30.26 2.5M79.4 42.48l-4.92-.41c-4.99-.42-11.22-8.34-14.12-7.92-2.91.41 4.15 6.25 1.66 9.17-2.78 3.25-16.2-.84-15.78 2.91.41 3.75 15.36 5 15.78 2.92.41-2.08-17.86 0-17.86 3.75s17.86 3.34 18.27 1.67c.42-1.67-15.78.42-15.78 3.75s16.61 3.33 17.03 1.67c.42-1.67-14.56 1.13-14.12 3.33.83 4.17 30.26 2.5 30.26 2.5",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"})),i.a.createElement("defs",null,i.a.createElement("clipPath",{id:"6dd800fc94d8ef6d718de2ecabdae5e2-a"},i.a.createElement("path",{fill:"#fff",d:"M0 0h88v88H0z"}))))}},vb1215:function(e,t,n){},vb1216:function(E,I,O){(function(e){var w,t,n;t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:this,n=function(t){"use strict";var n,r=t.Base64,e="2.4.3";if(E.exports)try{n=O("vb130").Buffer}catch(e){}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(a),i=String.fromCharCode,s=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?i(192|t>>>6)+i(128|63&t):i(224|t>>>12&15)+i(128|t>>>6&63)+i(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return i(240|t>>>18&7)+i(128|t>>>12&63)+i(128|t>>>6&63)+i(128|63&t)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(e){return e.replace(c,s)},u=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[a.charAt(n>>>18),a.charAt(n>>>12&63),2<=t?"=":a.charAt(n>>>6&63),1<=t?"=":a.charAt(63&n)].join("")},d=t.btoa?function(e){return t.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,u)},h=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e)).toString("base64")}:function(e){return(e.constructor===n.constructor?e:new n(e)).toString("base64")}:function(e){return d(l(e))},b=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):h(String(e))},f=function(e){return b(e,!0)},v=new RegExp(["[-][-]","[-][-]{2}","[-][-]{3}"].join("|"),"g"),p=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return i(55296+(t>>>10))+i(56320+(1023&t));case 3:return i((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return i((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},m=function(e){return e.replace(v,p)},g=function(e){var t=e.length,n=t%4,r=(0<t?o[e.charAt(0)]<<18:0)|(1<t?o[e.charAt(1)]<<12:0)|(2<t?o[e.charAt(2)]<<6:0)|(3<t?o[e.charAt(3)]:0),a=[i(r>>>16),i(r>>>8&255),i(255&r)];return a.length-=[0,0,2,1][n],a.join("")},y=t.atob?function(e){return t.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,g)},S=n?n.from&&n.from!==Uint8Array.from?function(e){return(e.constructor===n.constructor?e:n.from(e,"base64")).toString()}:function(e){return(e.constructor===n.constructor?e:new n(e,"base64")).toString()}:function(e){return m(y(e))},C=function(e){return S(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},k=function(){var e=t.Base64;return t.Base64=r,e};if(t.Base64={VERSION:e,atob:y,btoa:d,fromBase64:C,toBase64:b,utob:l,encode:b,encodeURI:f,btou:m,decode:C,noConflict:k},"function"==typeof Object.defineProperty){var T=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",T(function(){return C(this)})),Object.defineProperty(String.prototype,"toBase64",T(function(e){return b(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",T(function(){return b(this,!0)}))}}return t.Meteor&&(Base64=t.Base64),E.exports?E.exports.Base64=t.Base64:void 0===(w=function(){return t.Base64}.apply(I,[]))||(E.exports=w),{Base64:t.Base64}},E.exports=n(t)}).call(this,O("vb78"))},vb152:function(e,t,n){var r=n("vb364"),a=n("vb302"),o=r.t;e.exports=function(){var e=o.apply(null,arguments);return a(e)}},vb302:function(e,t,n){var r=n("vb303").getAppNameFromConfig;e.exports=function(e){var t=r();return e.replace(/\{\{APP_DISPLAY_NAME\}\}/g,t)}},vb303:function(e,v,p){"use strict";p.r(v),function(e){p.d(v,"getAppNameFromConfig",function(){return d});var t,n,r,a,o,i=p("vb144"),s=p("vb52"),c=null,l="undefined"==typeof window?e:window,u=(t={zh:"zh-CN",en:"en-US",ja:"ja-JP",fr:"fr-FR",hi:"hi-IN",id:"id-ID",it:"it-IT",ko:"ko-KR",pt:"pt-BR",ru:"ru-RU",th:"th-TH",vi:"vi-VN",de:"de-DE",es:"es-ES","zh-TW":"zh-TW","zh-HK":"zh-HK"},n=Object(s.a)(l,"User.language"),r=Object(s.a)(l,"navigator.language"),o=(a=n||r||"").split("-")[0],t[a]||t[o]||"en-US");function d(){if(null!==c)return c;var e="Lark";try{var t=l.globalConfig?l.globalConfig.common:l.backupDomain.ext,n="common."+Object(s.a)(t,"brand.app_name","").toLowerCase(),r=l.TTI18N[n];r&&(e=r)}catch(e){}return c=h()||b()||f()||e}function h(){var e=l.globalKaConfig;if(e){var t=Object(s.a)(e,"i18n.IDS_LARK_PRODUCT_NAME");return Object(i.a)(t)?t:""}}function b(){var e=l.globalKaConfig;if(e){var t=Object(s.a)(e,"i18n.app_name.$base","");return Object(s.a)(e,"i18n.app_name[".concat(u,"]"),t)}}function f(){if(l.materialConfig)return l.materialConfig.brand_app_name}}.call(this,p("vb78"))},vb310:function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return i});var r=n("vb59"),a=n.n(r),h=n("vb52"),b=n("vb53"),f=n("vb114");function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var p=Object(b.getAllUrlParams)().localhost,m={eventMap:null},i=function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if((Object(h.a)(window,"local.localhost")||p)&&console.log("collectBitableEvent",e,n),m.eventMap&&0<Object.keys(m.eventMap).length&&(t=m.eventMap[e]),Object(b.collectSuiteEvent)(e,v({is_bitable:!0},n,{},t)),r&&n.bitable_view_type){var a=n.smartable_token,o=n.row,i=n.col,s=n.table_id,c=n.bitable_view_type,l=n.bitable_field_type,u=n.view_id,d={is_bitable:!0,bitable_view_type:c};void 0!==a&&(d.smartable_token=a,d.bitable_id=a),void 0!==o&&(d.row=o),void 0!==i&&(d.col=i),void 0!==s&&(d.table_id=s),void 0!==l&&(d.bitable_field_type=l),void 0!==u&&(d.view_id=u),Object(b.collectSuiteEvent)(f.LogEvent.ClientFielBitableEdit,d)}}},vb337:function(e,t,n){"use strict";var r=function(){};e.exports=r},vb370:function(e,t){},vb372:function(e,t){},vb375:function(e,t,n){"use strict";var r,a,o,i;n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o}),(a=r||(r={})).Default="Default",a.EmbeddedInSheet="EmbeddedInSheet",a.EmbeddedInDoc="EmbeddedInDoc",(i=o||(o={})).Default="Default",i.Table="Table"},vb394:function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(e)}t.exports=n},vb415:function(r,e,t){var o=t("vb946");function a(e,t,n){return"undefined"!=typeof Reflect&&Reflect.get?r.exports=a=Reflect.get:r.exports=a=function(e,t,n){var r=o(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}},a(e,t,n||e)}r.exports=a},vb430:function(e,t,n){"use strict";var o=n("vb335"),i=n("vb348"),s=n("vb282");function r(e,r){var a={};return r=Object(s.a)(r,3),Object(i.a)(e,function(e,t,n){Object(o.a)(a,t,r(e,t,n))}),a}t.a=r},vb431:function(e,o,i){"use strict";(function(e){i.d(o,"a",function(){return a});var t=i("vb58"),n=i.n(t),r=i("vb595");i("vb596");function a(){return n.a.createElement("div",{className:"bitable-card-comment"},n.a.createElement("div",{className:"bitable-card-comment__title"},e("bitable.record_comments")),n.a.createElement("div",{className:"b-comment-loading-container"},n.a.createElement("div",{className:"b-comment-loading-content"},n.a.createElement(r.a,{className:"b-comment-loading-icon"}))))}}).call(this,i("vb152"))},vb432:function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},vb477:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n("vb309"),a=n.n(r),o=n("vb478"),i=n("vb130");function s(e){return JSON.parse(o.a.ungzip(i.Buffer.from(e,"base64"),{to:"string"}))}function c(e){return i.Buffer.from(o.a.gzip(JSON.stringify(e),{level:9})).toString("base64")}var l={ungzip:s,gzip:c},u=function(e){var t=l[e.method];if(t)return t.apply(void 0,a()(e.args))}},vb479:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o});var r=n("vb114");function a(e){var t=Object(r.selectCurrentSuitePermissionInfo)(e);return null!=t&&null!=t.get("permissions")&&Object(r.getIsEditable)(t.get("permissions"))}var o=Object(r.createPermissionsFieldSelector)("isContainerOrPageFA")},vb480:function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return b}),n.d(t,"c",function(){return f}),n.d(t,"d",function(){return v});var r=n("vb56"),a=n.n(r),o=n("vb64"),i=n.n(o),s=n("vb58"),c=n.n(s),l=n("vb61"),u=n.n(l),d=n("vb431"),h=u()({loader:function(){var e=i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("7bb53f704439"),n.e("1e1ebf3e2b21")]).then(n.bind(null,"vb867"));case 2:return e.abrupt("return",e.sent.BitableCommentBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),b=u()({loader:function(){var e=i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("7bb53f704439"),n.e("1e1ebf3e2b21")]).then(n.bind(null,"vb872"));case 2:return e.abrupt("return",e.sent.BitableCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return c.a.createElement(d.a,null)}}),f=u()({loader:function(){var e=i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("7bb53f704439"),n.e("3e7bc8266763")]).then(n.bind(null,"vb874"));case 2:return e.abrupt("return",e.sent.DocCommentBar);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return null}}),v=u()({loader:function(){var e=i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e("7bb53f704439"),n.e("3e7bc8266763")]).then(n.bind(null,"vb875"));case 2:return e.abrupt("return",e.sent.DocCommentCard);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),loading:function(){return c.a.createElement(d.a,null)}})},vb516:function(e,t,n){"use strict";var r=n("vb337"),_=n.n(r),a=n("vb347"),L=n.n(a);function b(e){return"/"===e.charAt(0)}function f(e,t){for(var n=t,r=n+1,a=e.length;r<a;n+=1,r+=1)e[n]=e[r];e.pop()}function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=e&&e.split("/")||[],r=t&&t.split("/")||[],a=e&&b(e),o=t&&b(t),i=a||o;if(e&&b(e)?r=n:n.length&&(r.pop(),r=r.concat(n)),!r.length)return"/";var s=void 0;if(r.length){var c=r[r.length-1];s="."===c||".."===c||""===c}else s=!1;for(var l=0,u=r.length;0<=u;u--){var d=r[u];"."===d?f(r,u):".."===d?(f(r,u),l++):l&&(f(r,u),l--)}if(!i)for(;l--;l)r.unshift("..");!i||""===r[0]||r[0]&&b(r[0])||r.unshift("");var h=r.join("/");return s&&"/"!==h.substr(-1)&&(h+="/"),h}var i=o;"function"==typeof Symbol&&Symbol.iterator;var j=function(e){return"/"===e.charAt(0)?e:"/"+e},F=function(e,t){return new RegExp("^"+t+"(\\/|\\?|#|$)","i").test(e)},U=function(e,t){return F(e,t)?e.substr(t.length):e},V=function(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e},s=function(e){var t=e||"/",n="",r="",a=t.indexOf("#");-1!==a&&(r=t.substr(a),t=t.substr(0,a));var o=t.indexOf("?");return-1!==o&&(n=t.substr(o),t=t.substr(0,o)),{pathname:t,search:"?"===n?"":n,hash:"#"===r?"":r}},H=function(e){var t=e.pathname,n=e.search,r=e.hash,a=t||"/";return n&&"?"!==n&&(a+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(a+="#"===r.charAt(0)?r:"#"+r),a},c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},N=function(e,t,n,r){var a=void 0;"string"==typeof e?(a=s(e)).state=t:(void 0===(a=c({},e)).pathname&&(a.pathname=""),a.search?"?"!==a.search.charAt(0)&&(a.search="?"+a.search):a.search="",a.hash?"#"!==a.hash.charAt(0)&&(a.hash="#"+a.hash):a.hash="",void 0!==t&&void 0===a.state&&(a.state=t));try{a.pathname=decodeURI(a.pathname)}catch(e){throw e instanceof URIError?new URIError('Pathname "'+a.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):e}return n&&(a.key=n),r?a.pathname?"/"!==a.pathname.charAt(0)&&(a.pathname=i(a.pathname,r.pathname)):a.pathname=r.pathname:a.pathname||(a.pathname="/"),a},W=function(){var o=null,r=[];return{setPrompt:function(e){return _()(null==o,"A history supports only one prompt at a time"),o=e,function(){o===e&&(o=null)}},confirmTransitionTo:function(e,t,n,r){if(null!=o){var a="function"==typeof o?o(e,t):o;"string"==typeof a?"function"==typeof n?n(a,r):(_()(!1,"A history needs a getUserConfirmation function in order to use a prompt message"),r(!0)):r(!1!==a)}else r(!0)},appendListener:function(e){var t=!0,n=function(){t&&e.apply(void 0,arguments)};return r.push(n),function(){t=!1,r=r.filter(function(e){return e!==n})}},notifyListeners:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];r.forEach(function(e){return e.apply(void 0,t)})}}},z=!("undefined"==typeof window||!window.document||!window.document.createElement),K=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},X=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},J=function(e,t){return t(window.confirm(e))},Q=function(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)},q=function(){return-1===window.navigator.userAgent.indexOf("Trident")},Y=function(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")},Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ee="popstate",te="hashchange",ne=function(){try{return window.history.state||{}}catch(e){return{}}},l=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};L()(z,"Browser history needs a DOM");var c=window.history,l=Q(),t=!q(),n=e.forceRefresh,u=void 0!==n&&n,r=e.getUserConfirmation,a=void 0===r?J:r,o=e.keyLength,i=void 0===o?6:o,s=e.basename?V(j(e.basename)):"",d=function(e){var t=e||{},n=t.key,r=t.state,a=window.location,o=a.pathname+a.search+a.hash;return _()(!s||F(o,s),'You are attempting to use a basename on a page whose URL path does not begin with the basename. Expected path "'+o+'" to begin with "'+s+'".'),s&&(o=U(o,s)),N(o,r,n)},h=function(){return Math.random().toString(36).substr(2,i)},b=W(),f=function(e){$(R,e),R.length=c.length,b.notifyListeners(R.location,R.action)},v=function(e){Y(e)||g(d(e.state))},p=function(){g(d(ne()))},m=!1,g=function(t){if(m)m=!1,f();else{var n="POP";b.confirmTransitionTo(t,n,a,function(e){e?f({action:n,location:t}):y(t)})}},y=function(e){var t=R.location,n=C.indexOf(t.key);-1===n&&(n=0);var r=C.indexOf(e.key);-1===r&&(r=0);var a=n-r;a&&(m=!0,E(a))},S=d(ne()),C=[S.key],k=function(e){return s+H(e)},T=function(e,t){_()(!("object"===(void 0===e?"undefined":Z(e))&&void 0!==e.state&&void 0!==t),"You should avoid providing a 2nd state argument to push when the 1st argument is a location-like object that already has state; it is ignored");var i="PUSH",s=N(e,t,h(),R.location);b.confirmTransitionTo(s,i,a,function(e){if(e){var t=k(s),n=s.key,r=s.state;if(l)if(c.pushState({key:n,state:r},null,t),u)window.location.href=t;else{var a=C.indexOf(R.location.key),o=C.slice(0,-1===a?0:a+1);o.push(s.key),C=o,f({action:i,location:s})}else _()(void 0===r,"Browser history cannot push state in browsers that do not support HTML5 history"),window.location.href=t}})},w=function(e,t){_()(!("object"===(void 0===e?"undefined":Z(e))&&void 0!==e.state&&void 0!==t),"You should avoid providing a 2nd state argument to replace when the 1st argument is a location-like object that already has state; it is ignored");var o="REPLACE",i=N(e,t,h(),R.location);b.confirmTransitionTo(i,o,a,function(e){if(e){var t=k(i),n=i.key,r=i.state;if(l)if(c.replaceState({key:n,state:r},null,t),u)window.location.replace(t);else{var a=C.indexOf(R.location.key);-1!==a&&(C[a]=i.key),f({action:o,location:i})}else _()(void 0===r,"Browser history cannot replace state in browsers that do not support HTML5 history"),window.location.replace(t)}})},E=function(e){c.go(e)},I=function(){return E(-1)},O=function(){return E(1)},M=0,B=function(e){1===(M+=e)?(K(window,ee,v),t&&K(window,te,p)):0===M&&(X(window,ee,v),t&&X(window,te,p))},D=!1,x=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=b.setPrompt(e);return D||(B(1),D=!0),function(){return D&&(D=!1,B(-1)),t()}},P=function(e){var t=b.appendListener(e);return B(1),function(){B(-1),t()}},R={length:c.length,action:"POP",location:S,createHref:k,push:T,replace:w,go:E,goBack:I,goForward:O,block:x,listen:P};return R};Object.assign,"function"==typeof Symbol&&Symbol.iterator,Object.assign;n.d(t,"a",function(){return l})},vb594:function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r=n("vb331"),o=n.n(r),a=n("vb56"),c=n.n(a),i=n("vb64"),l=n.n(i),s=n("vb59"),u=n.n(s),d=n("vb273"),h=n.n(d),b=n("vb274"),f=n.n(b),v=n("vb284"),p=n.n(v),m=n("vb58"),g=n.n(m),y=n("vb114"),S=n("vb936"),C=n("vb116"),k=n("vb53");Object(C.default)(y.BitableGlobalConfig),Object(k.injectEmbedBitableDep)(y.BitableGlobalConfig);var T=function(i){function s(e){var r;h()(this,s),(r=i.call(this,e)||this).commonInit=null,r._onMountFired=!1,r.getEventList=function(){var e;return e={},u()(e,y.Events.OperationProduced,r.onOperationProduced),u()(e,y.Events.ChangesetApplied,r.onChangesetApplied),e},r.toggleEvents=function(e){var t=r.getEventList();r.bitableStore&&(e?r.bitableStore.addEventListeners(r.state.tableId,t):r.bitableStore.removeEventListeners(r.state.tableId,t))},r.onOperationProduced=function(e){r.props.onChanged&&r.props.onChanged(e.token),r.handleTriggerTryEidt(e)},r.onChangesetApplied=function(e){r.props.onChanged&&r.props.onChanged(e.token)},r.onDocumentKeyInvalid=function(){r.forceUpdate()},r.setHistory=function(){},r.syncVirtualScroll=function(){},r.updateOverlayerPosition=function(){},r.updateHighlight=function(e){r.setState({commentActionType:e})},r.updateBitableSelectionState=function(e){},r.destroy=function(){},r.collapseLineChange=function(e){},r.updateBitableContent=function(){},r.cancelPaste=function(){r.renderer.isCancelPaste=!0},r.setWidth=function(e,t,n){t===r.state.width&&n===r.state.padding||r.setState({width:t,padding:n})},r.setDocWidth=function(e){e!==r.state.docWidth&&r.setState({docWidth:e})},r.setMaxWidth=function(e){e!==r.state.maxWidth&&r.setState({maxWidth:e,maxHeight:1/0})},r.setHeight=function(e){r.setState({height:e})},r.setSize=function(e,t){},r.setZoom=function(e){},r.loadedTable=function(e){},r.switchTable=function(e){},r.addNewTable=function(e){},r.addRecoverCallback=function(n){var e=r.props.tableId;r.recoverCb&&r.bitableStore.removeEventListeners(e,u()({},y.Events.FetchRecoverHistory,r.recoverCb)),r.recoverCb=function(e){var t="";(e.operations.some(function(e){return!!e.transactionId&&(t=e.transactionId)}),r.recoverTransaction)?t===r.recoverTransaction||n(t):n(t)},r.bitableStore.addEventListeners(e,u()({},y.Events.FetchRecoverHistory,r.recoverCb))},r.setCommentData=function(e,t){return r.smartableCommentManager.setCommentData(e,t)},r.startNewComment=function(e,t,n){return r.smartableCommentManager.startNewComment(e,t,n)},r.getComments=function(e){return r.smartableCommentManager.getComments(e)},r.setCommentBatchUpdate=function(e,t,n){r.smartableCommentManager.setBatchCommentUpdater(e,t,n)},r.addHoverHighlight=function(e,t){return r.smartableCommentManager.addHoverHighlight(e,t)},r.removeHoverHighlight=function(e,t){return r.smartableCommentManager.removeHoverHighlight(e,t)},r.getActiveComments=function(e){return r.smartableCommentManager.getActiveComments(e)},r.getResolvedComments=function(e){return r.smartableCommentManager.getResolvedComments(e)},r.setResolvedCommentIds=function(e,t){return r.smartableCommentManager.setResolvedCommentIds(e,t)},r.saveComment=function(e,t,n){return r.smartableCommentManager.saveComment(e,t,n)},r.removeComment=function(e,t){return r.smartableCommentManager.removeComment(e,t)},r.removeTempComment=function(e,t){return r.smartableCommentManager.removeTempComment(e,t)},r.resolveComment=function(e,t){return r.smartableCommentManager.resolveComment(e,t)},r.activateComment=function(e,t){return r.smartableCommentManager.activateComment(e,t)},r.deactivateComment=function(e,t){return r.smartableCommentManager.deactivateComment(e,t)},r.reopenComment=function(e,t){return r.smartableCommentManager.reopenComment(e,t)},r.findComment=function(e,t){return r.smartableCommentManager.findComment(e,t)},r.getTeaParams=function(e,t){return r.smartableCommentManager.getTeaParams(e,t)},r.getSmartableCommentManager=function(){return r.smartableCommentManager},r.getCommentPositions=function(e){return[]};var t=e.bitableStore,n=e.editable,a=void 0!==n&&n,o=e.mountOption;return t.setBasePermission(a),r.state={tableId:e.tableId,suspend:!1,width:S.a.width,padding:S.a.offsetX,commentActionType:e.commentActionType,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth,zoom:"number"==typeof e.zoom?e.zoom:1,isSelect:!1,height:e.height,delayLoading:!1,isHistoryMode:!1,collapsed:!1,errorCodeType:o.errorCodeType||y.EErrorCodeType.none},r.init(r._token),r}return p()(s,i),f()(s,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.width,r=t.padding,a=t.height,o=t.maxWidth,i=t.offsetX,s=t.docWidth;e.width===n&&e.padding===r&&e.height===a&&e.maxWidth===o&&e.offsetX===i&&e.docWidth===s||this.setState({width:e.width,padding:e.padding,height:e.height,maxWidth:e.maxWidth,offsetX:e.offsetX,docWidth:e.docWidth})}},{key:"componentDidMount",value:function(){var e=this.props.onMount;this.toggleEvents(!0),this.setHistory(),e&&e(this),this.renderer.storageManager.setToken(this._token),this.notifyEmbedBitableLoaded(),this.commonInit&&this.commonInit.init()}},{key:"componentDidUpdate",value:function(e){this.notifyEmbedBitableLoaded();var t=this.props,n=t.editable,r=void 0!==n&&n,a=t.bitableStore;r!==(e.editable||!1)&&a.setBasePermission(r)}},{key:"notifyEmbedBitableLoaded",value:function(){var e=this.props.onLoaded;if(!this._onMountFired&&e){var t=this.props,n=t.bitableStore,r=t.tableId;(n.isTableOrClientVarLoaded(r)||!1)&&(e(),this._onMountFired=!0)}}},{key:"componentWillUnmount",value:function(){this.props.bitableStore.getBaseEventManager().removeListener(y.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid),this.toggleEvents(!1),delete this.notify,this.commonInit&&this.commonInit.unbindEvents()}},{key:"_token",get:function(){return this.props.token}},{key:"init",value:function(e){var t=this.props,n=t.bitableStore,r=t.storageManager,a=t.isVCEnable,o=new y.Renderer(n,r,{reduxStore:this.props.store,isVCEnable:a});this.bitableStore=n,this.renderer=o,this.initCommentManager(),this.setHistory(),o.storageManager.setToken(e),n.getBaseEventManager().addListener(y.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"initCommentManager",value:function(){}},{key:"handleTriggerTryEidt",value:function(e){e.operation.command!==y.CollaCommands.AddComment&&k.BearWebHelper&&k.BearWebHelper.triggerBitableTryEdit&&k.BearWebHelper.triggerBitableTryEdit()}},{key:"takeScreenShot",value:function(){var n=l()(c.a.mark(function e(t,n){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){return{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t){}},{key:"setOffsetX",value:function(e){-30===e&&(e=0),e!==this.state.offsetX&&this.setState({offsetX:e})}},{key:"getSelection",value:function(){var e=this.renderer.activeBitableWidget;return e?e.getGridWidget().getSelection():null}},{key:"clearSelection",value:function(){var e=this.renderer.activeBitableWidget;if(!e)return null;e.getGridWidget().setSelection(null)}},{key:"switch",value:function(e,t){}},{key:"locateMention",value:function(){var r=l()(c.a.mark(function e(t,n,r){var a;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.renderer.showMentionInFeed(t,n,r);case 2:if(a=e.sent,"object"!==o()(a)){e.next=5;break}return e.abrupt("return",a);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"registerScrollContainerRef",value:function(e,t){}},{key:"getDocWidth",value:function(){return 0}},{key:"receive",value:function(e){switch(e){case y.notifyEvents.UpdateBitableById:this.renderer.updateFaster();break;default:return}}},{key:"setNotifier",value:function(e){this.notify=e}},{key:"suspend",value:function(){this.setState({suspend:!0})}},{key:"resume",value:function(){this.setState({suspend:!1})}},{key:"setRecoverTransactionId",value:function(t){var e=this,n="",r=Object.keys(t);r.some(function(e){return!!t[e].transaction_id&&(n=t[e].transaction_id,!0)}),this.bitableStore.base.getTables().forEach(function(t){r.some(function(e){return e===t.id})||e.bitableStore.resetSyncTableById(t.id)}),this.recoverTransaction=n}},{key:"previewHistory",value:function(e,t){this.setState({isHistoryMode:!0})}},{key:"exitHistory",value:function(){this.setState({isHistoryMode:!1})}},{key:"recover",value:function(){var t=l()(c.a.mark(function e(t){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"handleBitableIfPaste",value:function(){}},{key:"getZoom",value:function(){return 1}},{key:"onLoadedTable",value:function(){}},{key:"currentScreenShot",value:function(){}},{key:"freeze",value:function(){this.props.bitableStore.freeze()}},{key:"unfreeze",value:function(){this.props.bitableStore.unfreeze()}},{key:"updateErrorCodeType",value:function(e){e&&e!==this.state.errorCodeType&&this.setState({errorCodeType:e})}}]),s}(g.a.PureComponent)},vb595:function(e,t,n){"use strict";var r=n("vb432"),a=n.n(r),o=n("vb58"),i=n.n(o);function s(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}t.a=function(e){e.styles;var t=s(e,["styles"]);return i.a.createElement("svg",a()({width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},t),i.a.createElement("g",{fill:"#07F",fillRule:"nonzero"},i.a.createElement("circle",{opacity:".4",cx:"3.61",cy:"3.5",r:"3.5"}),i.a.createElement("path",{d:"M14.5 7a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"}),i.a.createElement("circle",{opacity:".7",cx:"14.5",cy:"14.5",r:"3.5"}),i.a.createElement("circle",{opacity:".2",cx:"3.5",cy:"14.5",r:"3.5"})))}},vb596:function(e,t,n){},vb597:function(e,t,n){},vb676:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n("vb273"),a=n.n(r),o=n("vb274"),i=n.n(o),s=function(){function e(){a()(this,e)}return i()(e,null,[{key:"createForFullScreen",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=document.createElement("div"),n=document.getElementById("mainContainer")||document.body;return e&&(n=document.querySelector(".create-by-template__container")||n),Object.assign(t.style,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",zIndex:"100",backgroundColor:"var(--bg-body)"}),t.className="layout-column flex",n.appendChild(t),t}},{key:"createForHistory",value:function(){var e=document.createElement("div"),t=document.getElementById("mainContainer");return Object.assign(e.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",zIndex:"88",backgroundColor:"var(--bg-body)"}),t.appendChild(e),e}},{key:"remove",value:function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}}]),e}()},vb677:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=function(e){return window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout(e,16)},a=function(e){window.cancelAnimationFrame?window.cancelAnimationFrame(e):window.clearTimeout(e)}},vb678:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n("vb148"),a=n("vb395"),o=n("vb114"),i=n("vb53"),s=n("vb1203"),c=n("vb1206");function l(e){return e&&(e=Object(r.a)(e)),Object(a.createStore)({initialState:e,enhancers:[],extensions:[Object(s.getSagaExtension)(),Object(c.getThunkExtension)()]},Object(i.getAppStateModule)(),Object(i.getEntitiesModule)(),Object(o.getBitableModule)())}},vb763:function(e,t,n){"use strict";function r(e,t){if("function"==typeof e&&"function"==typeof t)return e===t;if(!e||!t)return e===t;if("function"==typeof e)return(r=e)===(n=t).saga&&!n.argument;if("function"==typeof t){var n=t;return(r=e).saga===n&&!r.argument}var r;n=t;return(r=e).saga===n.saga&&r.argument===n.argument}t.__esModule=!0,t.sagaEquals=r},vb764:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={LOADED_BITABLE_BLOCK:"LOADED_BITABLE_BLOCK",BITABLE_ENTER_DOC_FULLSCREEN:"BitableEnterDocFullScreen",BITABLE_EXIT_DOC_FULLSCREEN:"BitableExitDocFullScreen",BITABLE_OVERLAYER_POSITION_UPDATING:"BitableOverlayerPositionUpdating"}},vb765:function(e,t,n){},vb766:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n("vb56"),o=n.n(r),a=n("vb64"),i=n.n(a),s=n("vb273"),c=n.n(s),l=n("vb274"),u=n.n(l),d=n("vb53"),h=n("vb114"),b=function(){function a(e){var r=this;c()(this,a),this.commentSDK=null,this.handleCommentDataChange=function(e,t,n){n&&n.isInit&&r.updateIsCommentDataInit()},this.updateIsCommentDataInit=function(){d.store.dispatch(Object(h.toggleIsCommentDataInit)(!0))};var t=e.suiteToken,n=e.suiteType;this.suiteToken=t,this.suiteType=n}return u()(a,[{key:"init",value:function(){var e=i()(o.a.mark(function e(){var t,n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d.loadableCommentDep)();case 3:if(t=e.sent,n=t.commentSDKManager,r=n.getOrCreate({serviceToken:this.suiteToken,serviceType:this.suiteType}),this.commentSDK=r){e.next=9;break}return e.abrupt("return");case 9:r&&r.hasInitCommentData&&this.updateIsCommentDataInit(),r.on("commentDataChange",this.handleCommentDataChange),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("CommentInit error",e.t0);case 17:case"end":return e.stop()}},e,this,[[0,14]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"unbindEvents",value:function(){this.commentSDK&&this.commentSDK.off("commentDataChange",this.handleCommentDataChange)}}]),a}()},vb767:function(e,z,K){"use strict";(function(o){K.d(z,"b",function(){return N}),K.d(z,"a",function(){return W});var e=K("vb56"),m=K.n(e),t=K("vb64"),i=K.n(t),n=K("vb59"),r=K.n(n),a=K("vb273"),s=K.n(a),c=K("vb274"),l=K.n(c),u=K("vb393"),v=K.n(u),d=K("vb284"),h=K.n(d),b=K("vb415"),p=K.n(b),f=K("vb394"),g=K.n(f),y=K("vb147"),S=K("vb87"),I=K.n(S),C=K("vb594"),O=K("vb114"),k=K("vb90"),M=K("vb53"),T=K("vb764"),w=K("vb58"),B=K.n(w),E=(K("vb1211"),K("vb143")),D=K.n(E),x=K("vb121"),P=K("vb115"),R=K("vb480"),_=K("vb479"),L=K("vb1212"),j=K("vb1213"),F=K("vb766");function U(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?U(Object(n),!0).forEach(function(e){r()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var H=!0,N=function(a){function c(e){var t,f;s()(this,c),(f=a.call(this,e)||this).updateSheetSelectionStateCoreTimer=0,f.overlayerRef=null,f.floatToolbarRef=null,f.docContainer=null,f.updateOverlayRafId=null,f.bitableRef=null,f.shouldBindContainerEvent=!0,f.scrollContainer=null,f.lastOverlayerPosition=null,f.collapseLineChange=function(e){f.state.collapsed!==e&&f.setState({collapsed:e})},f.updateBitableContent=function(){f.renderer.batchUpdateFaster()},f.syncVirtualScroll=function(){f.scrollHandle&&f.scrollHandle(),f.updateOverlayerPosition()},f.getActiveViewFromState=function(){var e=f.props.tableId,t=f.context.store;return Object(O.tableViewSelector)(t.getState(),e,Object(O.tableActiveViewIdSelector)(t.getState(),e))},f.onFullScreenClick=function(){var e=f.props,t=e.tableId,n=e.shell.onFullScreenMode,r=e.isFullScreenMode,a=e.setFullScreenTableId;if(!r&&n){n(t),a(t),O.BitableTea.collectBitableEvent(O.ClickEvent.CcmBitableToolbarClick,{click:O.ToolbarItemClickEventMap[O.ToolbarItemType.FULL_SCREEN],target:O.DEFAULT_TARGET}),f._setActiveBitable();var o=f.getActiveViewFromState();o&&O.BitableDep.collectBitableEvent("click_enter_full_screen",{source:"click_btn",block_type:"bitable",view_type:O.ViewTypeStringMap[o.type]})}},f.exitFullScreen=function(){var e=f.props,t=e.shell.exitFullScreenMode,n=e.isFullScreenMode,r=e.setFullScreenTableId;if(n&&t){t(),r(""),O.BitableTea.collectBitableEvent(O.ClickEvent.CcmBitableToolbarClick,{click:O.ToolbarItemClickEventMap[O.ToolbarItemType.FULL_SCREEN],target:O.DEFAULT_TARGET});var a=f.getActiveViewFromState();a&&O.BitableDep.collectBitableEvent("click_exit_full_screen",{source:"click_btn",block_type:"bitable",view_type:O.ViewTypeStringMap[a.type]})}},f.setSize=function(e,t){e!==f.state.maxWidth&&t!==f.state.maxHeight&&f.setState({maxWidth:e,maxHeight:t})},f.setZoom=function(e){e!==f.state.zoom&&f.setState({zoom:e})},f._doResizeInFullScreen=Object(y.a)(function(){f.setState({maxWidth:window.innerWidth})},100),f._setActiveBitable=function(){var e=f.props.tableId,t=v()(f).renderer;O.RendererManager.getActiveTableId()!==e&&O.RendererManager.setActiveRenderer(t)},f._handleFullScreenClick=function(){M.BearWebHelper&&M.BearWebHelper.triggerBitableFullScreenClick&&M.BearWebHelper.triggerBitableFullScreenClick()},f.setHistory=function(){f.props.storageManager.setHistory(f.props.history)},f.renderToolbar=function(e,t){var n,r,a=v()(f),o=a.props,i=a.state,s=o.bitableStore,c=o.tableId,l=o.isFullScreenMode,u=o.viewId,d=o.mountOption,h=i.docWidth,b=i.offsetX;return l||(n=V({position:"absolute",paddingLeft:e.paddingLeft||b,boxSizing:"content-box"},e),r=t),B.a.createElement("div",{className:D()("bitable-toolbar-doc-wrapper layout-row layout-cross-center f-s-0",{"bitable-toolbar-doc-fullscreen-wrapper":l}),ref:function(e){return f.toolBarRef=e},onWheel:r,style:n},B.a.createElement(O.EmbeddedDocToolBar,{tableId:c,viewId:u,isFullScreen:l,bitableStore:s,renderer:f.renderer,smartableCommentManager:f.smartableCommentManager,docWidth:h,exitFullScreen:l?f.exitFullScreen:void 0,viewsExclude:d.viewsExclude,sideBarOverlay:f.getIsDocx()?f.overlayerRef:null}),M.browser.safari&&B.a.createElement("div",{className:"j-safari-selection"}))},f.renderScreenShotToolbar=function(e,t){var n=V({position:"static"},e);return f.renderToolbar(n,t)},f.onShowFloatToolBar=function(){O.BitableTea.collectBitableEvent(O.ViewEvent.CcmBitableToolbarView,{trigger_type:O.ToolBarShowType.HoverWhole},!0,f.renderer)},f.setFloatToolbarRef=function(e){f.floatToolbarRef=e},f._updateOverlayPosition=function(){var e=f.props.mountOption;if(M.EventEmitter.emit(T.a.BITABLE_OVERLAYER_POSITION_UPDATING),f.overlayerRef){var t=e.operator.getBitablePosition(),n=t.left,r=t.top;if(f.lastOverlayerPosition&&f.lastOverlayerPosition.left===n&&f.lastOverlayerPosition.top===r)return;f.lastOverlayerPosition={top:r,left:n},f.overlayerRef.style.left=n+"px",f.overlayerRef.style.top=r+"px"}},f.updateOverlayerPosition=function(){f.props.isFullScreenMode||(f.getIsDocx()?f._updateOverlayPosition():(null!==f.updateOverlayRafId&&(cancelAnimationFrame(f.updateOverlayRafId),f.updateOverlayRafId=null),f.updateOverlayRafId=requestAnimationFrame(function(){f.updateOverlayRafId=null,f._updateOverlayPosition()})))},f.setOverLayerRef=function(e){f.overlayerRef=e},f.setOnScrollHandle=function(e){f.scrollHandle=e},f.setToolBarStyle=function(e,t){function n(e,t){return e.top===t.top&&e.bottom===t.bottom}e&&f.toolBarRef&&!n(f.toolBarRef.style,e)&&Object.assign(f.toolBarRef.style,e)},f.updateSelect=function(e,t){f.setState({isSelect:e,selectedStyle:t})},f.hoverBitable=function(){f.notify&&f.notify({name:"HoverDocBitable"}),f.setState({hoverBitable:!0})},f.receive=function(e){switch(p()((t=v()(f),g()(c.prototype)),"receive",t).call(t,e),e){case"HoverDocBitable":f.state.hoverBitable&&f.setState({hoverBitable:!1});break;default:return}},f.isMouseInOverlay=function(e){var t=f.props.mountOption.overlayContainer;return!!(t&&e&&t.contains(e))},f.leaveBitable=function(e){if(!1!==f.state.hoverBitable){var t=e.relatedTarget;if(!f.props.isFullScreenMode){var n=!1,r=!1;t instanceof Node&&(n=f.isMouseInOverlay(t),r=!(!f.bitableRef||!f.bitableRef.contains(t)));var a=!t||!t.classList||!t.classList.contains("J-bitable-container");n||r||!a||f.setState({hoverBitable:!1})}}},f.setBitableRef=function(e){f.embedBitableRef=e&&e.wrappedInstance?e.wrappedInstance:e,f.scrollContainer&&f.embedBitableRef&&f.embedBitableRef.registerScrollContainerRef&&f.embedBitableRef.registerScrollContainerRef(f.scrollContainer)},f.getSearchBaseOpts=function(){var e=v()(f).renderer,t=f.props;return{bitableStore:t.bitableStore,renderer:e,tableId:t.tableId,viewId:t.viewId}},f.highlightSearchItem=function(e,t,n){return Object(O.highlightSearchResultInDoc)(t,f.getSearchBaseOpts(),n)},f.setBitableContainerRef=function(e){f.bitableRef&&e!==f.bitableRef&&f.unbindBitableContainerEvent(),f.bitableRef=e,f.props.isFullScreenMode||f.bindBitableContainerEvent()},f.handleUploadError=function(e){var t=e&&e.errorType;if(M.BearWebHelper&&!M.BearWebHelper.isLark()&&M.Constant&&t===M.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_CREATE_LIMIT)M.BearWebHelper.triggerStoragePicLimitDialog();else if(M.BearWebHelper&&M.Constant&&t===M.Constant.WEB_UPLOAD_ERROR_CODE.UPLOAD_USER_STORAGE_LIMIT){var n={mountPoint:e.mountPoint,mountNodeToken:e.parentToken};M.BearWebHelper.triggerUserPicLimitDialog(n)}else M.Toast.show({type:"error",content:o("common.server_busy")})},f.triggerBitableCommentLoaded=i()(m.a.mark(function e(){var t,n,r,a,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.props,n=t.tableId,r=t.mountOption,!(a=r.operator)){e.next=7;break}return e.next=5,f.bitableStore.waitTableClientVarLoaded(n);case 5:o=f.smartableCommentManager.getComments(n),a.onCommentLoaded&&a.onCommentLoaded(o);case 7:case"end":return e.stop()}},e)})),f.renderBlockError=function(e){var t=f.state.offsetX;return B.a.createElement(j.a,{errorCodeType:e,offsetX:f.getIsDocx()?0:t})};var n=e.bitableStore,r=e.tableId;return n.initTableEventManager(r),f}return h()(c,a),l()(c,[{key:"componentDidMount",value:function(){var e=i()(m.a.mark(function e(){var t,n,r,a,o,i,s;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p()(g()(c.prototype),"componentDidMount",this).call(this),t=this.props,n=t.bitableStore,r=t.tableId,a=t.isFullScreenMode,o=t.setFullScreenTableId,i=t.setFloatToolbarTable,(s=n.base.getTableById(r))&&s.tableLoaded&&this.renderer.loadedTable(r),a&&(window.addEventListener("resize",this._doResizeInFullScreen),window.addEventListener("click",this._handleFullScreenClick),o(r),i("",!1),M.EventEmitter.emit(T.a.BITABLE_ENTER_DOC_FULLSCREEN)),this.triggerBitableCommentLoaded();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"componentWillUnmount",value:function(){var e=this.renderer,t=this.props,n=t.isFullScreenMode,r=t.setFullScreenTableId;n?(window.removeEventListener("resize",this._doResizeInFullScreen),window.removeEventListener("click",this._handleFullScreenClick),r(""),M.EventEmitter.emit(T.a.BITABLE_EXIT_DOC_FULLSCREEN),this.smartableCommentManager.exitDocFullScreen()):(e.destroyAllLoadingAttaches(),e.cancelPaste&&e.cancelPaste(),e.cancelPaste=null,this.updateOverlayRafId&&cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null,this.unbindBitableContainerEvent(),this.bitableRef=null),this.scrollHandle=function(){return null},p()(g()(c.prototype),"componentWillUnmount",this).call(this)}},{key:"componentWillReceiveProps",value:function(e){""!==e.fullScreenTableId&&this.setState({hoverBitable:!1}),e.isEditMode!==this.props.isEditMode&&(!1===e.isEditMode?this.freeze():this.unfreeze())}},{key:"handleBitableIfPaste",value:function(){var e=i()(m.a.mark(function e(){var t,n,r,a,o,i,s,c,l,u,d,h,b,f,v,p;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.renderer,n=this.props,r=n.tableId,a=n.bitableStore,o=n.initViewIdIndex,i=void 0===o?0:o,(s=x.bitableToPaste.get(r))&&s.status===x.BitableToPasteStatus.TO_PASTE){e.next=5;break}return e.abrupt("return");case 5:if(c=a.base.getTableById(r)){e.next=8;break}return e.abrupt("return");case 8:if(l=c.views[i]){e.next=11;break}return e.abrupt("return");case 11:if(s.status=x.BitableToPasteStatus.PASTING,x.bitableToPaste.set(r,s),u=s.source,d=null,u===x.BitablePasteSource.BLOCK?(h=s.tableDataSet,b=s.pasteTableBaseId,f=s.pasteComment,(d=P.DefaultActions.csToJSON(h,l.id,a.base,f))&&(d.baseId=b)):u===x.BitablePasteSource.BITABLE&&(d=s.stdValueTable),d){e.next=18;break}return e.abrupt("return");case 18:return v=t.clipboardHelper,p=new O.Range(0,0,l.getAllRecords().length,l.getColumnCount()),e.next=22,v.pasteForDocBlock(d,l,[p]);case 22:this.setState({delayLoading:!1}),s.status=x.BitableToPasteStatus.PASTED,x.bitableToPaste.set(r,s);case 25:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getFloatToolbarVisibility",value:function(){var e=this.state.hoverBitable,t=this.props,n=t.showFloatToolbar,r=t.isEditing,a=t.fullScreenTableId,o=t.tableId,i=""!==a,s=this.context.store,c=Object(O.getOtherFloatToolbarShowing)(s.getState(),o);if(i||c)return!1;var l=!!(n||r||e);return l?this.floatToolbarRef&&this.floatToolbarRef.addEventListener("click",this._setActiveBitable,!0):this.floatToolbarRef&&this.floatToolbarRef.removeEventListener("click",this._setActiveBitable,!0),l}},{key:"getDocContainer",value:function(){return this.docContainer||(this.getIsDocx()?this.docContainer=document.querySelector(".bear-web-x-container"):this.docContainer=document.querySelector(".history-editor-wrapper")||document.querySelector(".etherpad-container-wrapper")),this.docContainer}},{key:"init",value:function(e){var t=this.props,n=t.bitableStore,r=t.storageManager,a=t.tableId,o=t.initViewIdIndex,i=t.mountOption,s={tableId:a,initViewIdIndex:o,isFullScreen:!!t.isFullScreenMode,reduxStore:t.store,isVCEnable:H},c=new O.DocBitableRenderer(n,r,s);this.bitableStore=n,this.renderer=c,this.initCommentManager(),this.setHistory(),this.props.storageManager.setToken(e),i.operator.onRecover&&this.addRecoverCallback(i.operator.onRecover),n.getBaseEventManager().addListener(O.Events.DocumentKeyInvalid,this.onDocumentKeyInvalid)}},{key:"initCommentManager",value:function(){var e=this.props,t=e.bitableStore,n=e.mountOption,r=e.isFullScreenMode,a=e.smartableCommentManager,o=e.suiteToken,i=e.suiteType,s=n.operator.onActiveCommentChange,c=this.renderer;this.commonInit=new F.a({suiteToken:o,suiteType:i});var l={onActiveCommentChange:s};if(r)this.smartableCommentManager=a,this.smartableCommentManager.enterDocFullScreen(c);else{var u=M.CommentHelper&&M.CommentHelper.DocNewCommentEnable||this.getIsDocx();this.smartableCommentManager=new O.DocSmartableCommentManager({renderer:c,bitableStore:t,comment:l,customCommentCard:u?R.d:void 0,customCommentBar:u?R.c:void 0})}}},{key:"renderFloatToolbar",value:function(){var e=this.props,t=e.mountOption,n=e.tableId,r=e.viewId,a=e.bitableStore,o=e.fullScreenTableId,i=e.showFloatToolbar,s=e.isEditing,c=this.state,l=c.docWidth,u=c.offsetX;if(c.delayLoading)return null;var d={left:(void 0!==l?l:0)+u},h=""!==o,b=M.fsController.isInFullscreen();return B.a.createElement("div",{className:"bitable-float-toolbar-container",ref:this.setFloatToolbarRef,style:d},!h&&!b&&B.a.createElement(O.EmbeddedDocFloatToolBar,{tableId:n,viewId:r,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,onFullScreenClick:this.onFullScreenClick,bitableStore:a,mountOption:t,isShow:this.getFloatToolbarVisibility(),fixFloatToolbarShow:i||s,onShow:this.onShowFloatToolBar}))}},{key:"currentScreenShot",value:function(){if(this.embedBitableRef)return this.embedBitableRef.currentScreenShot();console.warn("bitable block is empty!")}},{key:"takeScreenShot",value:function(){var n=i()(m.a.mark(function e(t,n){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.embedBitableRef&&this.embedBitableRef.takeScreenShot&&this.embedBitableRef.takeScreenShot(t,n));case 1:case"end":return e.stop()}},e,this)}));function e(e,t){return n.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(){var e=this.renderer.activeBitableWidget&&this.renderer.activeBitableWidget.getActiveWidget();if(!e)return{scrollPosX:0,contentWidth:0};var t=e.getContentDocWidth?e.getContentDocWidth():0;return{scrollPosX:(e.getScrollPosition?e.getScrollPosition():{x:0}).x,contentWidth:t}}},{key:"setBitableViewScrollPosition",value:function(e,t){var n=this.renderer.activeBitableWidget&&this.renderer.activeBitableWidget.getActiveWidget();if(n){if(this.scrollContainer&&null!=t){var r=this.scrollContainer.current.getBoundingClientRect().width,a=this.scrollContainer.current.style.left||"0",o=r+parseInt(a,10)+t;n.setWidgetConfig&&n.setWidgetConfig({visibleRightBound:o}),this.setOffsetX(t)}null!=e&&n.setScrollPosition&&n.setScrollPosition(e)}}},{key:"renderOverlay",value:function(){var e=this.props.mountOption;if(!e.overlayContainer)return null;var t=e.operator.getBitablePosition(),n=t.left,r=t.top;return B.a.createElement("div",{ref:this.setOverLayerRef,className:D()("bitable-doc-overlay","bitable-toolbar-docx",{"bitable-doc-overlay-hide":this.state.suspend}),style:{top:r,left:n}},this.renderFloatToolbar())}},{key:"getSearchResult",value:function(e,t){var n=this,r=Object(O.getSearchResultInDoc)(e,t,this.getSearchBaseOpts()),a=this.getDocContainer();return a?r.map(function(e){return V({},e,{scrollFn:Object(O.getScrollFnInDoc)(e,n.getSearchBaseOpts(),a,n.bitableRef)})}):[]}},{key:"getSearchItemPos",value:function(e,t){return Object(O.getSearchItemRectInDoc)(t,this.getSearchBaseOpts())||{x:0,y:0,width:0,height:0}}},{key:"clearHighlight",value:function(e,t){return Object(O.clearHighlightInDoc)(this.getSearchBaseOpts())}},{key:"registerScrollContainerRef",value:function(e,t){this.scrollContainer=t,this.embedBitableRef&&this.embedBitableRef.registerScrollContainerRef&&this.embedBitableRef.registerScrollContainerRef(t)}},{key:"bindBitableContainerEvent",value:function(){this.bitableRef&&this.shouldBindContainerEvent&&(this.bitableRef.addEventListener("mouseenter",this.hoverBitable),this.bitableRef.addEventListener("mouseleave",this.leaveBitable),this.bitableRef.addEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!1)}},{key:"unbindBitableContainerEvent",value:function(){this.bitableRef&&(this.bitableRef.removeEventListener("mouseenter",this.hoverBitable),this.bitableRef.removeEventListener("mouseleave",this.leaveBitable),this.bitableRef.removeEventListener("click",this._setActiveBitable,!0),this.shouldBindContainerEvent=!0)}},{key:"getIsDocx",value:function(){return this.props.suiteType===M.NUM_FILE_TYPE.DOCX}},{key:"getBitableContainerStyle",value:function(){var e=this.props.isFullScreenMode,t=this.state,n=t.offsetX,r=t.docWidth,a=void 0===r?0:r;if(!e){var o=this.getActiveViewFromState();if(o&&o.type===O.ViewType.Grid)return{minWidth:a+n}}}},{key:"renderDocBitable",value:function(){var e=this.props,t=e.bitableStore,n=e.token,r=e.tableId,a=e.viewId,o=e.isFullScreenMode,i=e.shell,s=e.editbarPinChanged,c=e.mountOption,l=e.suiteType,u=this.state,d=u.maxWidth,h=u.maxHeight,b=u.offsetX,f=u.commentActionType,v=u.isSelect,p=u.docWidth,m=u.delayLoading,g=u.collapsed,y=c.overlayContainer,S=c.hideComment,C=c.isTemplateMode,k=l?M.SUITE_TO_MENTION_SOURCE[l]:M.SOURCE_ENUM.DOC,T=!(Object(L.a)()||Object(L.c)()||Object(L.b)()||S),w={attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:k},ui:{showComment:T}};return B.a.createElement(O.DocBitable,{token:n,bitableStore:t,renderer:this.renderer,isTemplateMode:C,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,IOConfig:{IO:M.IO.getInstance()},bitableConfig:w},B.a.createElement("div",{className:D()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":o}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!o&&y?I.a.createPortal(this.renderOverlay(),y):null,a&&B.a.createElement(O.DocTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:r,viewId:a,shell:i,maxWidth:d,maxHeight:h,offsetX:o?20:b,docWidth:p,commentActionType:f,isSelect:v,editbarPinChanged:s,renderEmbededToolbar:this.renderToolbar,notify:this.notify,isFullScreenMode:o,mountOption:c,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:m,collapsed:g,isVCEnable:H})))}},{key:"renderDocxBitable",value:function(){var n=this,e=this.props,t=e.bitableStore,r=e.token,a=e.tableId,o=e.viewId,i=e.isFullScreenMode,s=e.shell,c=e.editbarPinChanged,l=e.mountOption,u=e.suiteType,d=this.state,h=d.maxWidth,b=d.maxHeight,f=d.commentActionType,v=d.isSelect,p=d.docWidth,m=d.delayLoading,g=d.collapsed,y=d.selectedStyle,S=l.overlayContainer,C=l.hideComment,k=l.isTemplateMode,T=u?M.SUITE_TO_MENTION_SOURCE[u]:M.SOURCE_ENUM.DOC,w=function(e,t){return n.renderScreenShotToolbar(e,t)},E={ui:{bitableWidgetUIConfig:{disableHScroll:!i,ganttWidgetUIConfig:{marginRight:i?null:0},gridWidgetUIConfig:{marginRight:0},galleryWidgetUIConfig:{marginLeft:0},keepLastColumn:!1},showComment:!(Object(L.a)()||Object(L.c)()||Object(L.b)()||C),kanbanNewRecordOverlay:!0},attachmentUploadHooks:{uploadError:this.handleUploadError},mentionConfig:{mentionSource:T}};return B.a.createElement(O.DocBitable,{token:r,bitableStore:t,renderer:this.renderer,isTemplateMode:k,smartableCommentManager:this.smartableCommentManager,tableId:a,viewId:o,IOConfig:{IO:M.IO.getInstance()},bitableConfig:E},B.a.createElement("div",{className:D()("layout-column f-g-1 bitable-in-doc",{"bitable-in-doc-fullscreen":i}),ref:this.setBitableContainerRef,style:this.getBitableContainerStyle()},!i&&S?I.a.createPortal(this.renderOverlay(),S):null,o&&B.a.createElement(O.DocxTableView,{bitableStore:t,renderer:this.renderer,smartableCommentManager:this.smartableCommentManager,tableId:a,viewId:o,shell:s,maxWidth:h,maxHeight:b,offsetX:i?20:0,docWidth:p,commentActionType:f,isSelect:v,selectedStyle:y,editbarPinChanged:c,renderEmbededToolbar:this.renderToolbar,renderScreenShotToolbar:w,notify:this.notify,isFullScreenMode:i,mountOption:l,viewLayerOverlay:this.overlayerRef,setToolBarStyle:this.setToolBarStyle,setOnScrollHandle:this.setOnScrollHandle,updateOverlayerPosition:this.updateOverlayerPosition,zoom:this.state.zoom,ref:this.setBitableRef,delayLoading:m,collapsed:g,isVCEnable:H})))}},{key:"render",value:function(){var e=this.state.errorCodeType;return e!==O.EErrorCodeType.none?this.renderBlockError(e):this.getIsDocx()?this.renderDocxBitable():this.renderDocBitable()}}]),c}(C.a);N.contextType=k.ReactReduxContext;var W=Object(k.connect)(function(e,t){var n=t.tableId,r=!M.SuiteReduxSelector||!M.SuiteReduxSelector.selectIsInEditMode||M.SuiteReduxSelector.selectIsInEditMode(e);return{tableId:n,viewId:Object(O.tableActiveViewIdSelector)(e,n),query:Object(M.selectQuery)(e),showFloatToolbar:Object(O.floatToolbarVisibilitySelector)(e,n),isEditing:Object(O.editingSelector)(e,n),fullScreenTableId:Object(O.getFullScreenTableId)(e),suiteType:M.SuiteReduxSelector.selectCurrentSuiteType(e),suiteToken:M.SuiteReduxSelector.selectCurrentSuiteToken(e),isEditMode:r,editable:Object(_.a)(e)}},{setFullScreenTableId:O.setFullScreenTableId,setFloatToolbarTable:O.setFloatToolbarTable})(N)}).call(this,K("vb152"))},vb936:function(e,t,n){"use strict";var r=n("vb59"),a=n.n(r),o=n("vb56"),i=n.n(o),s=n("vb64"),c=n.n(s),l=n("vb273"),u=n.n(l),d=n("vb274"),h=n.n(d),b=n("vb676"),f=n("vb677"),v=n("vb58"),p=n.n(v),m=n("vb87"),g=n.n(m),y=n("vb90"),S=n("vb678"),C=n("vb284"),k=n.n(C),T=n("vb114"),w=n("vb375"),E=T.EmbeddedBitableHistoryForDoc,I=function(n){function r(e){var t;return u()(this,r),(t=n.call(this,e)||this).state={height:Math.round(.85*window.innerHeight)},t}return k()(r,n),h()(r,[{key:"componentDidMount",value:function(){var e=this;this._resizeHandler=function(){e.setState({height:Math.round(.85*window.innerHeight)})},window.addEventListener("resize",this._resizeHandler)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this._resizeHandler)}},{key:"render",value:function(){return p.a.createElement("div",{className:"bitable-in-doc-history-mode bitable-in-doc",style:{height:this.state.height}},p.a.createElement(E,Object.assign({},this.props,{embeddedType:w.a.EmbeddedInDoc,hideTab:!0})))}}]),r}(p.a.Component),O=n("vb53");function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){a()(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}n.d(t,"a",function(){return x}),n.d(t,"b",function(){return P});var D=240,x={width:D,offsetX:0},P=function(){function t(e){var o=this;u()(this,t),this.components=e,this.containerSize={},this.maxWidth=D,this.docWidth=2*D,this.actionTypeMap=new Map,this.zoom=1,this.updateOverlayRafId=null,this.openHistoryPanel=function(e){o.historyOverlay=b.a.createForHistory();var t=O.store.getState(),n=Object(S.a)(t);Object(f.a)(function(){g.a.render(p.a.createElement(y.Provider,{store:n},p.a.createElement(I,Object.assign({},e,{io:O.IO.getInstance(),store:n,hideHistory:o.closeHistoryPanel}))),o.historyOverlay)})},this.closeHistoryPanel=function(){var e=o.historyOverlay;e&&(g.a.unmountComponentAtNode(e),b.a.remove(e),o.historyOverlay=null)},this.locateMention=function(){var r=c()(i.a.mark(function e(t,n,r){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.components.get(t)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,a.locateMention(t,n,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(e,t,n){return r.apply(this,arguments)}}(),this.registerScrollContainerRef=function(e,t){var n=o.components.get(e);if(n)return n.registerScrollContainerRef&&n.registerScrollContainerRef(e,t)},this.updateErrorCodeType=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:T.EErrorCodeType.none,n=o.components.get(e);if(n)return n.updateErrorCodeType&&n.updateErrorCodeType(t)}}return h()(t,[{key:"setWidth",value:function(e,t,n){this.containerSize[e]||(this.containerSize[e]=B({},x)),this.containerSize[e].width=t,null!=n&&(this.containerSize[e].offsetX=n);var r=this.components.get(e);r&&(r.setMaxWidth(t),null!=n&&r.setOffsetX(n))}},{key:"setDocWidth",value:function(t,e){if(this.docWidth=t,e){var n=this.components.get(e);n&&n.setDocWidth(t)}else this.components.forEach(function(e){return e.setDocWidth(t)})}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"getWidth",value:function(){return this.maxWidth}},{key:"getDocWidth",value:function(){return this.docWidth}},{key:"getActionTypeMap",value:function(){return this.actionTypeMap}},{key:"setMaxWidth",value:function(e){var t=this;this.maxWidth=e,this.components.forEach(function(e){return e.setMaxWidth(t.maxWidth)})}},{key:"setHeight",value:function(t){this.height=t,this.components.forEach(function(e){return e.setHeight(t)})}},{key:"getHeight",value:function(){return this.height}},{key:"setSize",value:function(t,n){this.components.forEach(function(e){return e.setSize(t,n)})}},{key:"setZoom",value:function(t){this.zoom=t,this.components.forEach(function(e){return e.setZoom(t)})}},{key:"getZoom",value:function(){return this.zoom}},{key:"syncVirtualScroll",value:function(e){var n=this;e&&e.length?e.forEach(function(e){var t=n.components.get(e);t&&t.syncVirtualScroll()}):this.components.forEach(function(e){return e.syncVirtualScroll()})}},{key:"onBlockPositionChange",value:function(){var e=this;null!==this.updateOverlayRafId&&(cancelAnimationFrame(this.updateOverlayRafId),this.updateOverlayRafId=null),this.updateOverlayRafId=requestAnimationFrame(function(){e.updateOverlayRafId=null,e.components.forEach(function(e){return e.updateOverlayerPosition()})})}},{key:"currentScreenShot",value:function(e){var t=this.components.get(e);if(t)return t.currentScreenShot()}},{key:"takeScreenShot",value:function(){var r=c()(i.a.mark(function e(t,n,r){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this.components.get(t))||!a.takeScreenShot){e.next=3;break}return e.abrupt("return",a.takeScreenShot(n,r));case 3:case"end":return e.stop()}},e,this)}));function e(e,t,n){return r.apply(this,arguments)}return e}()},{key:"getBitableViewScrollInfo",value:function(e){var t=this.components.get(e);return t&&t.getBitableViewScrollInfo?t.getBitableViewScrollInfo():{scrollPosX:0,contentWidth:0}}},{key:"setBitableViewScrollPosition",value:function(e,t,n){var r=this.components.get(e);if(r&&r.setBitableViewScrollPosition)return r.setBitableViewScrollPosition(t,n)}},{key:"updateSelectionState",value:function(e,t,n){var r=this.components.get(e);r&&r.updateSelect?r.updateSelect(t,n):console.warn("component not found, unable to update")}},{key:"updateHighlight",value:function(e,t){var n=this.components.get(e);n?n.updateHighlight(t):this.actionTypeMap.set(e,t)}},{key:"updateBitableContent",value:function(e){var t=this.components.get(e);t&&t.updateBitableContent()}},{key:"collapseLineChange",value:function(e,t){var n=this.components.get(e);n&&n.collapseLineChange(t)}},{key:"getSearchResult",value:function(e,t){var n=this.components.get(e);return n&&n.getSearchResult?n.getSearchResult(e,t):[]}},{key:"getSearchItemPos",value:function(e,t){var n=this.components.get(e);return n&&n.getSearchItemPos?n.getSearchItemPos(e,t):{x:0,y:0,width:0,height:0}}},{key:"highlightSearchItem",value:function(e,t,n){var r=this.components.get(e);r&&r.highlightSearchItem&&r.highlightSearchItem(e,t,n)}},{key:"clearHighlight",value:function(e,t){var n=this.components.get(e);n&&n.clearHighlight&&n.clearHighlight(e,t)}}]),t}()},vb946:function(e,t,n){var r=n("vb394");function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}e.exports=a}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=vb_EmbeddedBitable_DocManager.4195c98a8e.chunk.js